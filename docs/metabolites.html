<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Metabolic rates</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="site_libs/viz-1.8.2/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">respiration_exp_evolution</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Metabolic rates</h1>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-12-04
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>exp_evol_respiration/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20190703code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20190703)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20190703code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20190703)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanexpevolrespirationtreed441b69aad98ed57bbbddc2bf3a648c6dfc3d6a4targetblankd441b69a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/lukeholman/exp_evol_respiration/tree/d441b69aad98ed57bbbddc2bf3a648c6dfc3d6a4" target="_blank">d441b69</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanexpevolrespirationtreed441b69aad98ed57bbbddc2bf3a648c6dfc3d6a4targetblankd441b69a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/lukeholman/exp_evol_respiration/tree/d441b69aad98ed57bbbddc2bf3a648c6dfc3d6a4" target="_blank">d441b69</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rproj.user/
    Ignored:    analysis/.DS_Store

Untracked files:
    Untracked:  data/3.metabolite_data.csv
    Untracked:  output/brms_metabolite_PCA_SEM.rds
    Untracked:  output/brms_metabolite_SEM.rds

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/metabolites.Rmd</code>) and HTML (<code>docs/metabolites.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/d441b69aad98ed57bbbddc2bf3a648c6dfc3d6a4/analysis/metabolites.Rmd" target="_blank">d441b69</a>
</td>
<td>
lukeholman
</td>
<td>
2020-12-04
</td>
<td>
Luke metabolites analysis
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/c8feb2d375c449e40555f76ffe6d557a6424980b/analysis/metabolites.Rmd" target="_blank">c8feb2d</a>
</td>
<td>
lukeholman
</td>
<td>
2020-11-30
</td>
<td>
Same page with Martin
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/3fdbcb2298a2ba799632cade777d185e30eb9ec0/docs/metabolites.html" target="_blank">3fdbcb2</a>
</td>
<td>
lukeholman
</td>
<td>
2020-11-30
</td>
<td>
Tweaks Nov 2020
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="load-packages" class="section level2">
<h2>Load packages</h2>
<pre class="r"><code>library(tidyverse)
library(GGally)
library(gridExtra)
library(ggridges)

library(nlme)
library(brms)
library(tidybayes)

library(kableExtra)
library(knitrhooks) # install with devtools::install_github(&quot;nathaneastwood/knitrhooks&quot;)

output_max_height() # a knitrhook option

options(stringsAsFactors = FALSE)</code></pre>
</div>
<div id="load-metabolite-composition-data" class="section level2">
<h2>Load metabolite composition data</h2>
<p>This analysis set out to test whether sexual selection treatment had an effect on metabolite composition of flies. We measured fresh and dry fly weight in milligrams, plus the weights of five metabolites which together equal the dry weight. These are:</p>
<ul>
<li><code>Lipid_conc</code> (i.e. the weight of the hexane fraction, divided by the full dry weight),</li>
<li><code>Carbohydrate_conc</code> (i.e. the weight of the aqueous fraction, divided by the full dry weight),</li>
<li><code>Protein_conc</code> (i.e. <span class="math inline">\(\mu\)</span>g of protein per milligram as measured by the bicinchoninic acid protein assay),</li>
<li><code>Glycogen_conc</code> (), and</li>
<li><code>Chitin_conc</code> ()</li>
</ul>
<p>We expect body weight to vary between the sexes and potentially between treatments. In turn, we expect body weight to affect our five response variables of interest. Larger flies will have more lipids, carbs, etc., and this may vary by sex and treatment both directly and indirectly.</p>
<pre class="r"><code>metabolites &lt;- read_csv(&#39;data/3.metabolite_data.csv&#39;) %&gt;%
  mutate(sex = ifelse(sex == &quot;m&quot;, &quot;Male&quot;, &quot;Female&quot;),
         treatment = ifelse(treatment == &quot;M&quot;, &quot;Monogamy&quot;, &quot;Polyandry&quot;)) %&gt;%
  # set &quot;sum&quot; coding for contrasts for &quot;line&quot;, since there is no meaningful &quot;control line&quot;
  mutate(line = C(factor(line), &quot;contr.sum&quot;)) %&gt;%  
  # log transform glycogen since it shows a long tail (others are reasonably normal-looking)
  mutate(Glycogen_ug_mg = log(Glycogen_ug_mg)) %&gt;%
  # There was a technical error with the flies collected on day 1, so they are excluded from the whole paper. All measurements are of 3d-old flies
  filter(time == &#39;2&#39;) 

scaled_metabolites &lt;- metabolites %&gt;% 
  # Find proportional metabolites as a proportion of total dry weight
  mutate(
    Dry_weight = dwt_mg,
    Lipid_conc = Hex_frac / Dry_weight,
    Carbohydrate_conc = Aq_frac / Dry_weight,
    Protein_conc = Protein_ug_mg,
    Glycogen_conc = Glycogen_ug_mg,
    Chitin_conc = Chitin_mg_mg
  ) %&gt;% 
  select(sex, treatment, line, Dry_weight, ends_with(&quot;conc&quot;)) %&gt;%
  mutate_at(vars(ends_with(&quot;conc&quot;)), ~ as.numeric(scale(.x))) %&gt;%
  mutate(sextreat = paste(sex, treatment),
         sextreat = replace(sextreat, sextreat == &quot;Male Monogamy&quot;, &quot;M males&quot;),
         sextreat = replace(sextreat, sextreat == &quot;Male Polyandry&quot;, &quot;P males&quot;),
         sextreat = replace(sextreat, sextreat == &quot;Female Monogamy&quot;, &quot;M females&quot;),
         sextreat = replace(sextreat, sextreat == &quot;Female Polyandry&quot;, &quot;P females&quot;),
         sextreat = factor(sextreat, c(&quot;M males&quot;, &quot;P males&quot;, &quot;M females&quot;, &quot;P females&quot;)))</code></pre>
<pre class="r"><code>cols &lt;- c(&quot;M females&quot; = &quot;pink&quot;, 
          &quot;P females&quot; = &quot;red&quot;, 
          &quot;M males&quot; = &quot;skyblue&quot;, 
          &quot;P males&quot; = &quot;blue&quot;)

modified_densityDiag &lt;- function(data, mapping, ...) {
  ggally_densityDiag(data, mapping, ...) + scale_fill_manual(values = cols) + 
  scale_x_continuous(guide = guide_axis(check.overlap = TRUE))
}

modified_points &lt;- function(data, mapping, ...) {
  ggally_points(data, mapping, ...) + scale_colour_manual(values = cols) + 
  scale_x_continuous(guide = guide_axis(check.overlap = TRUE))
}

modified_facetdensity &lt;- function(data, mapping, ...) {
  ggally_facetdensity(data, mapping, ...) + scale_colour_manual(values = cols)
}

modified_box_no_facet &lt;- function(data, mapping, ...) {
  ggally_box_no_facet(data, mapping, ...) + scale_fill_manual(values = cols)
}

pairs_plot &lt;- scaled_metabolites %&gt;% 
  select(-line) %&gt;%
  arrange(sex, treatment) %&gt;%
  ggpairs(aes(colour = sextreat),
          diag = list(continuous = wrap(modified_densityDiag, alpha = 0.7),
                      discrete = wrap(&quot;blank&quot;)),
          lower = list(continuous = wrap(modified_points, alpha = 0.7, size = 0.5), 
                       discrete = wrap(&quot;blank&quot;),
                       combo = wrap(modified_box_no_facet, alpha = 0.7)),
          upper = list(continuous = wrap(modified_points, alpha = 0.7, size = 0.5),
                       discrete = wrap(&quot;blank&quot;),
                       combo = wrap(modified_facetdensity, alpha = 0.7, size = 0.5))) 
pairs_plot</code></pre>
<p><img src="figure/metabolites.Rmd/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="dag" class="section level2">
<h2>DAG</h2>
<pre class="r"><code>DiagrammeR::grViz(&#39;digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

&quot;Metabolite\ncomposition&quot; [shape = oval, fillcolor = Beige]

# edge definitions with the node IDs
&quot;Mating system\ntreatment (M vs P)&quot; -&gt; {&quot;Body mass&quot;}
&quot;Mating system\ntreatment (M vs P)&quot; -&gt; {&quot;Metabolite\ncomposition&quot;} 

&quot;Sex\n(Female vs Male)&quot; -&gt; {&quot;Body mass&quot;} -&gt; {&quot;Metabolite\ncomposition&quot;}
&quot;Sex\n(Female vs Male)&quot; -&gt; {&quot;Metabolite\ncomposition&quot;}

{&quot;Metabolite\ncomposition&quot;} -&gt; &quot;Lipids&quot;
{&quot;Metabolite\ncomposition&quot;} -&gt; &quot;Carbohydrates&quot;
{&quot;Metabolite\ncomposition&quot;} -&gt; &quot;Glycogencogen&quot;
{&quot;Metabolite\ncomposition&quot;} -&gt; &quot;Protein&quot;
{&quot;Metabolite\ncomposition&quot;} -&gt; &quot;Chitin&quot;
}&#39;)</code></pre>
<div id="htmlwidget-6ec5e240e3b68e9cc473" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ec5e240e3b68e9cc473">{"x":{"diagram":"digraph {\n\ngraph [layout = dot, rankdir = LR]\n\n# define the global styles of the nodes. We can override these in box if we wish\nnode [shape = rectangle, style = filled, fillcolor = Linen]\n\n\"Metabolite\ncomposition\" [shape = oval, fillcolor = Beige]\n\n# edge definitions with the node IDs\n\"Mating system\ntreatment (M vs P)\" -> {\"Body mass\"}\n\"Mating system\ntreatment (M vs P)\" -> {\"Metabolite\ncomposition\"} \n\n\"Sex\n(Female vs Male)\" -> {\"Body mass\"} -> {\"Metabolite\ncomposition\"}\n\"Sex\n(Female vs Male)\" -> {\"Metabolite\ncomposition\"}\n\n{\"Metabolite\ncomposition\"} -> \"Lipids\"\n{\"Metabolite\ncomposition\"} -> \"Carbohydrates\"\n{\"Metabolite\ncomposition\"} -> \"Glycogencogen\"\n{\"Metabolite\ncomposition\"} -> \"Protein\"\n{\"Metabolite\ncomposition\"} -> \"Chitin\"\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="inspecting-the-raw-data" class="section level2">
<h2>Inspecting the raw data</h2>
<pre class="r"><code>levels &lt;- c(&quot;Carbohydrate&quot;, &quot;Chitin&quot;, &quot;Glycogen&quot;, &quot;Lipid&quot;, &quot;Protein&quot;, &quot;Dryweight&quot;)

grid.arrange(
  scaled_metabolites %&gt;% 
    rename_all(~ str_remove_all(.x, &quot;_conc&quot;)) %&gt;%
    mutate(sex = factor(sex, c(&quot;Male&quot;, &quot;Female&quot;))) %&gt;%
    reshape2::melt(id.vars = c(&#39;sex&#39;, &#39;treatment&#39;, &#39;sextreat&#39;, &#39;line&#39;, &#39;Dry_weight&#39;)) %&gt;% 
    mutate(variable = factor(variable, levels)) %&gt;%
    ggplot(aes(x = sex, y = value,  fill  = sextreat)) +
    geom_hline(yintercept = 0, linetype = 2) + 
    geom_boxplot() + 
    facet_grid( ~ variable) +
    theme_bw() +
    xlab(&quot;Sex&quot;) + ylab(&quot;Concentration&quot;) +
    theme(legend.position = &#39;top&#39;) + 
    scale_fill_manual(values = cols, name = &quot;&quot;),
  
  scaled_metabolites %&gt;% 
    rename_all(~ str_remove_all(.x, &quot;_conc&quot;)) %&gt;%
    reshape2::melt(id.vars = c(&#39;sex&#39;, &#39;treatment&#39;, &#39;sextreat&#39;, &#39;line&#39;, &#39;Dry_weight&#39;)) %&gt;% 
    mutate(variable = factor(variable, levels)) %&gt;%
    ggplot(aes(x = Dry_weight, y = value, colour = sextreat, fill = sextreat)) +
    geom_smooth(method = &#39;lm&#39;, se = TRUE, aes(colour = NULL, fill = NULL), colour = &quot;grey20&quot;, size = .4) +
    geom_point(pch = 21, colour = &quot;grey20&quot;) +
    facet_grid( ~ variable) +
    theme_bw() +
    xlab(&quot;Dry weight (mg)&quot;) + ylab(&quot;Concentration&quot;) +
    theme(legend.position = &#39;none&#39;) + 
    scale_colour_manual(values = cols, name = &quot;&quot;) + 
    scale_fill_manual(values = cols, name = &quot;&quot;),
  heights = c(0.55, 0.45)
)</code></pre>
<p><img src="figure/metabolites.Rmd/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="fit-brms-structural-equation-model" class="section level1">
<h1>Fit <code>brms</code> structural equation model</h1>
<p>Here we fit a model of the five metabolites, which includes dry body weight as a mediator variable. That is, our model estimates the effect of treatment, sex and line (and all the 2- and 3-way interactions) on dry weight, and then estimates the effect of those some predictors (plus dry weight) on the five metabolites. The model assumes that although the different sexes, treatment groups, and lines may differ in their dry weight, the relationship between dry weight and the metabolites does not vary by sex/treatment/line. This assumption was made to constrain the number of parameters in the model, and to reflect out prior beliefs about allometric scaling of metabolites.</p>
<div id="define-priors" class="section level3">
<h3>Define Priors</h3>
<p>Set Normal priors on all fixed effect parameters, mean = 0, sd = 2. As well as fitting our expectations about the true values of these parameters, setting somewhat informative priors constrains the effects sizes and helps the model to converge. We leave other priors at their defaults.</p>
<pre class="r"><code>prior1 &lt;- c(set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Lipid&#39;),
            set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Carbohydrate&#39;),
            set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Protein&#39;),
            set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Glycogen&#39;),
            set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Chitin&#39;),
            set_prior(&quot;normal(0, 2)&quot;, class = &quot;b&quot;, resp = &#39;Dryweight&#39;))</code></pre>
</div>
<div id="running-the-model" class="section level3">
<h3>Running the model</h3>
<pre class="r"><code># Formula for the SEM:
brms_formula &lt;- 
  
  # Models of the 5 metabolites
  bf(mvbind(Lipid, Carbohydrate, Protein, Glycogen, Chitin) ~ 
       sex*treatment*line + Dryweight) +
  
  # dry weight sub-model
   bf(Dryweight ~ sex*treatment*line) +
  
  # Allow for (and estimate) covariance between the residuals of the difference response variables
  set_rescor(TRUE)

if(!file.exists(&quot;output/brms_metabolite_SEM.rds&quot;)){
  brms_metabolite_SEM &lt;- brm(
    brms_formula,
    data = scaled_metabolites %&gt;% # brms does not like underscores in variable names
      rename(Dryweight = Dry_weight) %&gt;%
      rename_all(~ gsub(&quot;_conc&quot;, &quot;&quot;, .x)),
    iter = 5000, chains = 4, cores = 1,
    prior = prior1,
    control = list(max_treedepth = 20,
                   adapt_delta = 0.9)
  )
  
  saveRDS(brms_metabolite_SEM, &quot;output/brms_metabolite_SEM.rds&quot;)
} else {
  brms_metabolite_SEM &lt;- readRDS(&#39;output/brms_metabolite_SEM.rds&#39;)
}</code></pre>
<pre class="r"><code>grid.arrange(
  pp_check(brms_metabolite_SEM, resp = &quot;Dryweight&quot;) + 
    ggtitle(&quot;Dry weight&quot;) + theme(legend.position = &quot;none&quot;),
  pp_check(brms_metabolite_SEM, resp = &quot;Lipid&quot;) + 
    ggtitle(&quot;Lipid&quot;) + theme(legend.position = &quot;none&quot;),
  pp_check(brms_metabolite_SEM, resp = &quot;Carbohydrate&quot;) + 
    ggtitle(&quot;Carbohydrate&quot;) + theme(legend.position = &quot;none&quot;),
  pp_check(brms_metabolite_SEM, resp = &quot;Protein&quot;) + 
    ggtitle(&quot;Protein&quot;) + theme(legend.position = &quot;none&quot;),
  pp_check(brms_metabolite_SEM, resp = &quot;Glycogen&quot;) + 
    ggtitle(&quot;Glycogen&quot;) + theme(legend.position = &quot;none&quot;),
  pp_check(brms_metabolite_SEM, resp = &quot;Chitin&quot;) + 
    ggtitle(&quot;Chitin&quot;) + theme(legend.position = &quot;none&quot;),
  nrow = 1
)</code></pre>
<p><img src="figure/metabolites.Rmd/unnamed-chunk-8-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="table-of-model-parameter-estimates" class="section level2 tabset">
<h2>Table of model parameter estimates</h2>
<div id="formatted-table" class="section level3">
<h3>Formatted table</h3>
<p>This tables shows the parameter estimates for the fixed effects associated with treatment, sex, their interaction, and dry weight (where relevant) for each response variable. The <code>p</code> column shows 1 - minus the “probability of direction”, i.e. the posterior probability that the reported sign of the estimate is correct given the data and the prior; subtracting this value from one gives a Bayesian equivalent of a one-sided p-value. For brevity, we have omitted all the parameter estimates involving the predictor variable <code>line</code>, as well as the estiamtes of residual (co)variance. Click the next tab to see a complete summary of the model and its output.</p>
<pre class="r"><code>vars &lt;- c(&quot;Lipid&quot;, &quot;Carbohydrate&quot;, &quot;Glycogen&quot;, &quot;Protein&quot;, &quot;Chitin&quot;)
tests &lt;- c(&#39;_Dryweight&#39;, &#39;_sexMale&#39;,
           &#39;_sexMale:treatmentPolyandry&#39;,
           &#39;_treatmentPolyandry&#39;)

hypSEM &lt;- data.frame(expand_grid(vars, tests) %&gt;% 
                       mutate(est = NA,
                              err = NA,
                              lwr = NA,
                              upr = NA) %&gt;% 
                       # bind body weight on the end
                       rbind(data.frame(
                         vars = rep(&#39;Dryweight&#39;, 3),
                         tests = c(&#39;_sexMale&#39;, 
                                   &#39;_treatmentPolyandry&#39;, 
                                   &#39;_sexMale:treatmentPolyandry&#39;),
                         est = NA,
                         err = NA,
                         lwr = NA,
                         upr = NA)))

for(i in 1:nrow(hypSEM)) {
  
  result = hypothesis(brms_metabolite_SEM, 
                      paste0(hypSEM[i, 1], hypSEM[i, 2], &#39; = 0&#39;))$hypothesis

  hypSEM[i, 3] = round(result$Estimate, 3)
  hypSEM[i, 4] = round(result$Est.Error, 3)
  hypSEM[i, 5] = round(result$CI.Lower, 3)
  hypSEM[i, 6] = round(result$CI.Upper, 3)

}

pvals &lt;- bayestestR::p_direction(brms_metabolite_SEM) %&gt;% 
  as.data.frame() %&gt;%
  mutate(vars = map_chr(str_split(Parameter, &quot;_&quot;), ~ .x[2]),
         tests = map_chr(str_split(Parameter, &quot;_&quot;), ~ .x[3]),
         tests = str_c(&quot;_&quot;, str_remove_all(tests, &quot;[.]&quot;)),
         tests = replace(tests, tests == &quot;_sexMaletreatmentPolyandry&quot;, &quot;_sexMale:treatmentPolyandry&quot;)) %&gt;%
  filter(!str_detect(tests, &quot;line&quot;)) %&gt;%
  mutate(p_val = 1 - pd, star = ifelse(p_val &lt; 0.05, &quot;*&quot;, &quot;&quot;)) %&gt;%
  select(vars, tests, p_val, star)


hypSEM &lt;- hypSEM %&gt;% left_join(pvals, by = c(&quot;vars&quot;, &quot;tests&quot;))

hypSEM  %&gt;% 
  mutate(Parameter = c(rep(c(&#39;Dry weight&#39;, &#39;Male&#39;, 
                             &#39;Male x Polyandry&#39;, 
                             &#39;Polyandry&#39;), 5), 
                       &#39;Male&#39;, &#39;Polyandry&#39;, &#39;Male x Polyandry&#39;))  %&gt;% 
  mutate(Parameter = factor(Parameter, c(&quot;Dry weight&quot;, &quot;Male&quot;, &quot;Polyandry&quot;, &quot;Male x Polyandry&quot;)),
         vars = factor(vars, c(&quot;Carbohydrate&quot;, &quot;Chitin&quot;, &quot;Glycogen&quot;, &quot;Lipid&quot;, &quot;Protein&quot;, &quot;Dryweight&quot;))) %&gt;%
  arrange(vars, Parameter) %&gt;%
  select(Parameter, Estimate = est, `Est. error` = err, 
         `CI lower` = lwr, `CI upper` = upr, `p` = p_val, star) %&gt;% 
  rename(` ` = star) %&gt;%
  kable() %&gt;% 
  kable_styling(full_width = FALSE) %&gt;%
  group_rows(&quot;Carbohydrates&quot;, 1, 4) %&gt;%
  group_rows(&quot;Chitin&quot;, 5, 8) %&gt;%
  group_rows(&quot;Glycogen&quot;, 9, 12) %&gt;%
  group_rows(&quot;Lipids&quot;, 13, 16) %&gt;% 
  group_rows(&quot;Protein&quot;, 17, 20) %&gt;% 
  group_rows(&quot;Dry weight&quot;, 21, 23)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est. error
</th>
<th style="text-align:right;">
CI lower
</th>
<th style="text-align:right;">
CI upper
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Carbohydrates</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Dry weight
</td>
<td style="text-align:right;">
0.228
</td>
<td style="text-align:right;">
1.857
</td>
<td style="text-align:right;">
-3.397
</td>
<td style="text-align:right;">
3.837
</td>
<td style="text-align:right;">
0.4494
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-0.085
</td>
<td style="text-align:right;">
0.537
</td>
<td style="text-align:right;">
-1.133
</td>
<td style="text-align:right;">
0.967
</td>
<td style="text-align:right;">
0.4395
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
-0.277
</td>
<td style="text-align:right;">
0.355
</td>
<td style="text-align:right;">
-0.960
</td>
<td style="text-align:right;">
0.444
</td>
<td style="text-align:right;">
0.2097
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
-0.524
</td>
<td style="text-align:right;">
0.462
</td>
<td style="text-align:right;">
-1.436
</td>
<td style="text-align:right;">
0.392
</td>
<td style="text-align:right;">
0.1265
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Chitin</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Dry weight
</td>
<td style="text-align:right;">
-0.276
</td>
<td style="text-align:right;">
1.841
</td>
<td style="text-align:right;">
-3.884
</td>
<td style="text-align:right;">
3.305
</td>
<td style="text-align:right;">
0.4385
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
1.291
</td>
<td style="text-align:right;">
0.499
</td>
<td style="text-align:right;">
0.301
</td>
<td style="text-align:right;">
2.268
</td>
<td style="text-align:right;">
0.0055
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
-0.258
</td>
<td style="text-align:right;">
0.295
</td>
<td style="text-align:right;">
-0.837
</td>
<td style="text-align:right;">
0.326
</td>
<td style="text-align:right;">
0.1880
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
-0.357
</td>
<td style="text-align:right;">
0.378
</td>
<td style="text-align:right;">
-1.112
</td>
<td style="text-align:right;">
0.379
</td>
<td style="text-align:right;">
0.1651
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Glycogen</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Dry weight
</td>
<td style="text-align:right;">
0.387
</td>
<td style="text-align:right;">
1.839
</td>
<td style="text-align:right;">
-3.185
</td>
<td style="text-align:right;">
4.006
</td>
<td style="text-align:right;">
0.4188
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-0.968
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
-2.008
</td>
<td style="text-align:right;">
0.053
</td>
<td style="text-align:right;">
0.0304
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.275
</td>
<td style="text-align:right;">
0.344
</td>
<td style="text-align:right;">
-0.386
</td>
<td style="text-align:right;">
0.969
</td>
<td style="text-align:right;">
0.2091
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
0.637
</td>
<td style="text-align:right;">
0.447
</td>
<td style="text-align:right;">
-0.242
</td>
<td style="text-align:right;">
1.502
</td>
<td style="text-align:right;">
0.0746
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Lipids</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Dry weight
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
1.832
</td>
<td style="text-align:right;">
-2.583
</td>
<td style="text-align:right;">
4.573
</td>
<td style="text-align:right;">
0.2927
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-0.780
</td>
<td style="text-align:right;">
0.493
</td>
<td style="text-align:right;">
-1.756
</td>
<td style="text-align:right;">
0.176
</td>
<td style="text-align:right;">
0.0549
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.741
</td>
<td style="text-align:right;">
0.286
</td>
<td style="text-align:right;">
0.182
</td>
<td style="text-align:right;">
1.306
</td>
<td style="text-align:right;">
0.0055
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
-0.241
</td>
<td style="text-align:right;">
0.364
</td>
<td style="text-align:right;">
-0.959
</td>
<td style="text-align:right;">
0.478
</td>
<td style="text-align:right;">
0.2529
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Protein</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Dry weight
</td>
<td style="text-align:right;">
-0.291
</td>
<td style="text-align:right;">
1.840
</td>
<td style="text-align:right;">
-3.879
</td>
<td style="text-align:right;">
3.284
</td>
<td style="text-align:right;">
0.4416
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
0.074
</td>
<td style="text-align:right;">
0.554
</td>
<td style="text-align:right;">
-1.009
</td>
<td style="text-align:right;">
1.175
</td>
<td style="text-align:right;">
0.4487
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
-0.605
</td>
<td style="text-align:right;">
0.398
</td>
<td style="text-align:right;">
-1.392
</td>
<td style="text-align:right;">
0.169
</td>
<td style="text-align:right;">
0.0634
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
0.838
</td>
<td style="text-align:right;">
0.529
</td>
<td style="text-align:right;">
-0.212
</td>
<td style="text-align:right;">
1.878
</td>
<td style="text-align:right;">
0.0550
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="3">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Dry weight</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-0.232
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.265
</td>
<td style="text-align:right;">
-0.199
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.049
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.0001
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Polyandry
</td>
<td style="text-align:right;">
-0.059
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
-0.105
</td>
<td style="text-align:right;">
-0.013
</td>
<td style="text-align:right;">
0.0076
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="complete-output-from-summary.brmsfit" class="section level3">
<h3>Complete output from <code>summary.brmsfit()</code></h3>
<pre class="r"><code>brms_metabolite_SEM</code></pre>
<pre> Family: MV(gaussian, gaussian, gaussian, gaussian, gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: Lipid ~ sex * treatment * line + Dryweight 
         Carbohydrate ~ sex * treatment * line + Dryweight 
         Protein ~ sex * treatment * line + Dryweight 
         Glycogen ~ sex * treatment * line + Dryweight 
         Chitin ~ sex * treatment * line + Dryweight 
         Dryweight ~ sex * treatment * line 
   Data: scaled_metabolites %>% rename(Dryweight = Dry_weig (Number of observations: 48) 
Samples: 4 chains, each with iter = 5000; warmup = 2500; thin = 1;
         total post-warmup samples = 10000

Population-Level Effects: 
                                              Estimate Est.Error l-95% CI
Lipid_Intercept                                  -0.39      1.05    -2.43
Carbohydrate_Intercept                            0.20      1.07    -1.86
Protein_Intercept                                 0.19      1.07    -1.87
Glycogen_Intercept                                0.01      1.05    -2.08
Chitin_Intercept                                 -0.30      1.05    -2.34
Dryweight_Intercept                               0.56      0.01     0.54
Lipid_sexMale                                    -0.78      0.49    -1.76
Lipid_treatmentPolyandry                          0.74      0.29     0.18
Lipid_line1                                      -0.43      0.33    -1.08
Lipid_line2                                       0.72      0.30     0.12
Lipid_line3                                       0.11      0.29    -0.46
Lipid_Dryweight                                   1.00      1.83    -2.58
Lipid_sexMale:treatmentPolyandry                 -0.24      0.36    -0.96
Lipid_sexMale:line1                               1.13      0.45     0.25
Lipid_sexMale:line2                              -1.01      0.42    -1.81
Lipid_sexMale:line3                               0.05      0.41    -0.79
Lipid_treatmentPolyandry:line1                    0.67      0.41    -0.13
Lipid_treatmentPolyandry:line2                   -1.60      0.44    -2.47
Lipid_treatmentPolyandry:line3                    0.72      0.41    -0.10
Lipid_sexMale:treatmentPolyandry:line1           -0.94      0.56    -2.02
Lipid_sexMale:treatmentPolyandry:line2            1.83      0.58     0.67
Lipid_sexMale:treatmentPolyandry:line3           -1.13      0.57    -2.23
Carbohydrate_sexMale                             -0.09      0.54    -1.13
Carbohydrate_treatmentPolyandry                  -0.28      0.35    -0.96
Carbohydrate_line1                                0.04      0.39    -0.72
Carbohydrate_line2                                0.72      0.38    -0.03
Carbohydrate_line3                                0.11      0.37    -0.64
Carbohydrate_Dryweight                            0.23      1.86    -3.40
Carbohydrate_sexMale:treatmentPolyandry          -0.52      0.46    -1.44
Carbohydrate_sexMale:line1                       -0.50      0.53    -1.55
Carbohydrate_sexMale:line2                       -0.84      0.52    -1.86
Carbohydrate_sexMale:line3                        0.08      0.52    -0.93
Carbohydrate_treatmentPolyandry:line1            -0.15      0.52    -1.15
Carbohydrate_treatmentPolyandry:line2            -1.02      0.54    -2.08
Carbohydrate_treatmentPolyandry:line3            -0.39      0.51    -1.38
Carbohydrate_sexMale:treatmentPolyandry:line1     0.15      0.70    -1.23
Carbohydrate_sexMale:treatmentPolyandry:line2    -0.33      0.72    -1.77
Carbohydrate_sexMale:treatmentPolyandry:line3     1.52      0.71     0.11
Protein_sexMale                                   0.07      0.55    -1.01
Protein_treatmentPolyandry                       -0.61      0.40    -1.39
Protein_line1                                     0.07      0.44    -0.78
Protein_line2                                     0.50      0.43    -0.34
Protein_line3                                    -0.21      0.43    -1.05
Protein_Dryweight                                -0.29      1.84    -3.88
Protein_sexMale:treatmentPolyandry                0.84      0.53    -0.21
Protein_sexMale:line1                            -0.35      0.59    -1.52
Protein_sexMale:line2                             0.64      0.58    -0.53
Protein_sexMale:line3                            -0.98      0.59    -2.11
Protein_treatmentPolyandry:line1                 -0.30      0.58    -1.45
Protein_treatmentPolyandry:line2                 -0.17      0.60    -1.37
Protein_treatmentPolyandry:line3                  0.73      0.58    -0.39
Protein_sexMale:treatmentPolyandry:line1          0.08      0.79    -1.45
Protein_sexMale:treatmentPolyandry:line2         -1.05      0.79    -2.59
Protein_sexMale:treatmentPolyandry:line3          1.04      0.80    -0.54
Glycogen_sexMale                                 -0.97      0.52    -2.01
Glycogen_treatmentPolyandry                       0.27      0.34    -0.39
Glycogen_line1                                   -0.02      0.38    -0.79
Glycogen_line2                                    0.06      0.36    -0.65
Glycogen_line3                                    0.61      0.36    -0.11
Glycogen_Dryweight                                0.39      1.84    -3.18
Glycogen_sexMale:treatmentPolyandry               0.64      0.45    -0.24
Glycogen_sexMale:line1                            0.04      0.52    -0.97
Glycogen_sexMale:line2                            0.17      0.50    -0.82
Glycogen_sexMale:line3                           -0.16      0.50    -1.16
Glycogen_treatmentPolyandry:line1                -0.14      0.50    -1.11
Glycogen_treatmentPolyandry:line2                -0.26      0.52    -1.30
Glycogen_treatmentPolyandry:line3                -1.00      0.50    -1.96
Glycogen_sexMale:treatmentPolyandry:line1         0.94      0.68    -0.38
Glycogen_sexMale:treatmentPolyandry:line2         0.13      0.69    -1.23
Glycogen_sexMale:treatmentPolyandry:line3         1.14      0.69    -0.21
Chitin_sexMale                                    1.29      0.50     0.30
Chitin_treatmentPolyandry                        -0.26      0.29    -0.84
Chitin_line1                                      0.19      0.34    -0.48
Chitin_line2                                     -0.22      0.31    -0.83
Chitin_line3                                     -0.22      0.30    -0.81
Chitin_Dryweight                                 -0.28      1.84    -3.88
Chitin_sexMale:treatmentPolyandry                -0.36      0.38    -1.11
Chitin_sexMale:line1                              0.48      0.45    -0.41
Chitin_sexMale:line2                              0.68      0.43    -0.17
Chitin_sexMale:line3                             -0.16      0.43    -1.00
Chitin_treatmentPolyandry:line1                  -0.61      0.43    -1.45
Chitin_treatmentPolyandry:line2                   0.71      0.45    -0.19
Chitin_treatmentPolyandry:line3                   0.04      0.42    -0.80
Chitin_sexMale:treatmentPolyandry:line1           0.35      0.58    -0.83
Chitin_sexMale:treatmentPolyandry:line2          -0.18      0.60    -1.34
Chitin_sexMale:treatmentPolyandry:line3          -1.03      0.59    -2.20
Dryweight_sexMale                                -0.23      0.02    -0.26
Dryweight_treatmentPolyandry                      0.08      0.02     0.05
Dryweight_line1                                  -0.08      0.02    -0.13
Dryweight_line2                                   0.05      0.02     0.01
Dryweight_line3                                   0.02      0.02    -0.02
Dryweight_sexMale:treatmentPolyandry             -0.06      0.02    -0.11
Dryweight_sexMale:line1                           0.10      0.03     0.05
Dryweight_sexMale:line2                          -0.05      0.03    -0.11
Dryweight_sexMale:line3                          -0.04      0.03    -0.09
Dryweight_treatmentPolyandry:line1                0.05      0.03    -0.01
Dryweight_treatmentPolyandry:line2               -0.10      0.03    -0.16
Dryweight_treatmentPolyandry:line3                0.02      0.03    -0.03
Dryweight_sexMale:treatmentPolyandry:line1       -0.04      0.04    -0.12
Dryweight_sexMale:treatmentPolyandry:line2        0.09      0.04     0.01
Dryweight_sexMale:treatmentPolyandry:line3       -0.04      0.04    -0.11
                                              u-95% CI Rhat Bulk_ESS Tail_ESS
Lipid_Intercept                                   1.66 1.00     5551     7569
Carbohydrate_Intercept                            2.31 1.00     7351     7899
Protein_Intercept                                 2.27 1.00     9759     8118
Glycogen_Intercept                                2.08 1.00     7214     7629
Chitin_Intercept                                  1.76 1.00     6201     7685
Dryweight_Intercept                               0.59 1.00    11265     8219
Lipid_sexMale                                     0.18 1.00     6532     7398
Lipid_treatmentPolyandry                          1.31 1.00     7245     7264
Lipid_line1                                       0.21 1.00     5387     7115
Lipid_line2                                       1.31 1.00     5658     6416
Lipid_line3                                       0.70 1.00     6594     7292
Lipid_Dryweight                                   4.57 1.00     5337     7107
Lipid_sexMale:treatmentPolyandry                  0.48 1.00     8883     7368
Lipid_sexMale:line1                               2.00 1.00     5645     7458
Lipid_sexMale:line2                              -0.19 1.00     6022     6806
Lipid_sexMale:line3                               0.86 1.00     6543     7299
Lipid_treatmentPolyandry:line1                    1.48 1.00     6594     7054
Lipid_treatmentPolyandry:line2                   -0.74 1.00     5455     6969
Lipid_treatmentPolyandry:line3                    1.52 1.00     6785     8045
Lipid_sexMale:treatmentPolyandry:line1            0.17 1.00     6910     7415
Lipid_sexMale:treatmentPolyandry:line2            2.93 1.00     6035     7359
Lipid_sexMale:treatmentPolyandry:line3           -0.01 1.00     6391     7264
Carbohydrate_sexMale                              0.97 1.00     8672     7918
Carbohydrate_treatmentPolyandry                   0.44 1.00     8986     8208
Carbohydrate_line1                                0.80 1.00     6352     7094
Carbohydrate_line2                                1.47 1.00     6475     7027
Carbohydrate_line3                                0.83 1.00     6608     7158
Carbohydrate_Dryweight                            3.84 1.00     6924     7193
Carbohydrate_sexMale:treatmentPolyandry           0.39 1.00     9195     8198
Carbohydrate_sexMale:line1                        0.55 1.00     6408     7770
Carbohydrate_sexMale:line2                        0.17 1.00     6464     6647
Carbohydrate_sexMale:line3                        1.12 1.00     6828     7354
Carbohydrate_treatmentPolyandry:line1             0.85 1.00     7020     7773
Carbohydrate_treatmentPolyandry:line2             0.06 1.00     6314     7447
Carbohydrate_treatmentPolyandry:line3             0.61 1.00     6808     7753
Carbohydrate_sexMale:treatmentPolyandry:line1     1.53 1.00     7296     7651
Carbohydrate_sexMale:treatmentPolyandry:line2     1.07 1.00     6550     7213
Carbohydrate_sexMale:treatmentPolyandry:line3     2.88 1.00     7062     8090
Protein_sexMale                                   1.18 1.00    10143     7950
Protein_treatmentPolyandry                        0.17 1.00     9880     7799
Protein_line1                                     0.93 1.00     6938     7152
Protein_line2                                     1.35 1.00     7763     7455
Protein_line3                                     0.62 1.00     7871     7521
Protein_Dryweight                                 3.28 1.00     9605     8248
Protein_sexMale:treatmentPolyandry                1.88 1.00     9986     8005
Protein_sexMale:line1                             0.82 1.00     6994     6894
Protein_sexMale:line2                             1.76 1.00     7873     7792
Protein_sexMale:line3                             0.20 1.00     7968     7765
Protein_treatmentPolyandry:line1                  0.83 1.00     7854     7732
Protein_treatmentPolyandry:line2                  1.00 1.00     7693     7641
Protein_treatmentPolyandry:line3                  1.84 1.00     7964     7559
Protein_sexMale:treatmentPolyandry:line1          1.59 1.00     8586     7540
Protein_sexMale:treatmentPolyandry:line2          0.50 1.00     8232     7742
Protein_sexMale:treatmentPolyandry:line3          2.62 1.00     8589     8176
Glycogen_sexMale                                  0.05 1.00     8773     7568
Glycogen_treatmentPolyandry                       0.97 1.00     8364     7116
Glycogen_line1                                    0.73 1.00     6298     7153
Glycogen_line2                                    0.78 1.00     6892     7693
Glycogen_line3                                    1.32 1.00     6475     7544
Glycogen_Dryweight                                4.01 1.00     6959     7392
Glycogen_sexMale:treatmentPolyandry               1.50 1.00     9605     8578
Glycogen_sexMale:line1                            1.07 1.00     6612     7953
Glycogen_sexMale:line2                            1.13 1.00     6752     7640
Glycogen_sexMale:line3                            0.84 1.00     7485     8166
Glycogen_treatmentPolyandry:line1                 0.88 1.00     7077     7651
Glycogen_treatmentPolyandry:line2                 0.76 1.00     6719     7792
Glycogen_treatmentPolyandry:line3                -0.00 1.00     7061     7456
Glycogen_sexMale:treatmentPolyandry:line1         2.27 1.00     8055     7837
Glycogen_sexMale:treatmentPolyandry:line2         1.49 1.00     6930     8033
Glycogen_sexMale:treatmentPolyandry:line3         2.49 1.00     8104     7647
Chitin_sexMale                                    2.27 1.00     7388     7646
Chitin_treatmentPolyandry                         0.33 1.00     7955     7902
Chitin_line1                                      0.86 1.00     4969     7418
Chitin_line2                                      0.42 1.00     5478     6553
Chitin_line3                                      0.38 1.00     7039     7596
Chitin_Dryweight                                  3.30 1.00     5894     7347
Chitin_sexMale:treatmentPolyandry                 0.38 1.00     9669     7598
Chitin_sexMale:line1                              1.38 1.00     5068     6947
Chitin_sexMale:line2                              1.52 1.00     5514     7692
Chitin_sexMale:line3                              0.69 1.00     7006     7681
Chitin_treatmentPolyandry:line1                   0.25 1.00     6490     7390
Chitin_treatmentPolyandry:line2                   1.58 1.00     5410     7563
Chitin_treatmentPolyandry:line3                   0.86 1.00     6930     7244
Chitin_sexMale:treatmentPolyandry:line1           1.47 1.00     6770     7632
Chitin_sexMale:treatmentPolyandry:line2           0.99 1.00     5753     6256
Chitin_sexMale:treatmentPolyandry:line3           0.13 1.00     7297     7761
Dryweight_sexMale                                -0.20 1.00    11022     8161
Dryweight_treatmentPolyandry                      0.12 1.00    10140     8280
Dryweight_line1                                  -0.05 1.00     5592     6742
Dryweight_line2                                   0.09 1.00     6334     7190
Dryweight_line3                                   0.06 1.00     5839     6788
Dryweight_sexMale:treatmentPolyandry             -0.01 1.00     8996     7885
Dryweight_sexMale:line1                           0.16 1.00     6072     7282
Dryweight_sexMale:line2                           0.01 1.00     5836     7023
Dryweight_sexMale:line3                           0.02 1.00     5680     6662
Dryweight_treatmentPolyandry:line1                0.11 1.00     5645     6996
Dryweight_treatmentPolyandry:line2               -0.05 1.00     6067     7584
Dryweight_treatmentPolyandry:line3                0.08 1.00     6124     7170
Dryweight_sexMale:treatmentPolyandry:line1        0.03 1.00     6181     7101
Dryweight_sexMale:treatmentPolyandry:line2        0.17 1.00     6135     7022
Dryweight_sexMale:treatmentPolyandry:line3        0.04 1.00     5896     6520

Family Specific Parameters: 
                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_Lipid            0.62      0.08     0.48     0.81 1.00     8901     7960
sigma_Carbohydrate     0.81      0.11     0.64     1.05 1.00     9453     8007
sigma_Protein          0.94      0.13     0.73     1.23 1.00     9378     8359
sigma_Glycogen         0.78      0.11     0.60     1.01 1.00     8671     7494
sigma_Chitin           0.65      0.09     0.50     0.85 1.00     8997     7939
sigma_Dryweight        0.04      0.01     0.03     0.05 1.00     7737     7539

Residual Correlations: 
                               Estimate Est.Error l-95% CI u-95% CI Rhat
rescor(Lipid,Carbohydrate)        -0.44      0.14    -0.69    -0.14 1.00
rescor(Lipid,Protein)              0.02      0.16    -0.30     0.33 1.00
rescor(Carbohydrate,Protein)      -0.07      0.16    -0.38     0.26 1.00
rescor(Lipid,Glycogen)             0.06      0.17    -0.27     0.37 1.00
rescor(Carbohydrate,Glycogen)     -0.10      0.16    -0.40     0.23 1.00
rescor(Protein,Glycogen)          -0.13      0.16    -0.44     0.20 1.00
rescor(Lipid,Chitin)              -0.16      0.16    -0.47     0.17 1.00
rescor(Carbohydrate,Chitin)       -0.13      0.16    -0.44     0.20 1.00
rescor(Protein,Chitin)             0.21      0.16    -0.12     0.50 1.00
rescor(Glycogen,Chitin)           -0.01      0.16    -0.32     0.31 1.00
rescor(Lipid,Dryweight)            0.02      0.19    -0.36     0.39 1.00
rescor(Carbohydrate,Dryweight)     0.09      0.18    -0.27     0.43 1.00
rescor(Protein,Dryweight)         -0.06      0.17    -0.39     0.29 1.00
rescor(Glycogen,Dryweight)         0.16      0.18    -0.20     0.50 1.00
rescor(Chitin,Dryweight)           0.05      0.19    -0.32     0.41 1.00
                               Bulk_ESS Tail_ESS
rescor(Lipid,Carbohydrate)         8396     8362
rescor(Lipid,Protein)              9839     8907
rescor(Carbohydrate,Protein)       9856     8076
rescor(Lipid,Glycogen)             9353     8153
rescor(Carbohydrate,Glycogen)     10131     8136
rescor(Protein,Glycogen)           8928     7780
rescor(Lipid,Chitin)               9773     7628
rescor(Carbohydrate,Chitin)       10661     8345
rescor(Protein,Chitin)             8109     8028
rescor(Glycogen,Chitin)            8418     7801
rescor(Lipid,Dryweight)            5645     7685
rescor(Carbohydrate,Dryweight)     7230     8198
rescor(Protein,Dryweight)          7524     7753
rescor(Glycogen,Dryweight)         6149     7587
rescor(Chitin,Dryweight)           5949     7942

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).
</pre>
<!-- Plot posteriors for response variables and body size separately. -->
<!-- ```{r, fig.height=3, fig.width=10} -->
<!-- # get posterior predictions -->
<!-- post_dat <- posterior_samples(brms_metabolite_SEM) %>%  -->
<!--   as_tibble() %>% -->
<!--   select(contains("b_"), -contains("Intercept")) %>%  -->
<!--   mutate(draw = 1:n()) %>%  -->
<!--   pivot_longer(-draw) %>%  -->
<!--   mutate(key = str_remove_all(name, "b_"), -->
<!--          var = gsub("_.*", "", x = key), -->
<!--          eff = gsub(".*_", "", x = key)) %>% -->
<!--   select(-name, -key) %>%  -->
<!--   filter(!grepl("line", eff)) %>%  -->
<!--   arrange(var, eff) -->
<!-- grid.arrange( -->
<!--   post_dat %>% -->
<!--     filter(var != 'Dryweight') %>%  -->
<!--     ggplot(aes(value, eff, fill = eff)) +  -->
<!--     geom_vline(xintercept = 0, linetype = 2) +  -->
<!--     stat_halfeyeh(alpha = .8) + -->
<!--     scale_fill_brewer(palette = "Spectral") + -->
<!--     ylab("Model parameter") + -->
<!--     xlab("Effect on Metabolite abundance (SDs)") +  -->
<!--     facet_wrap(~ var, ncol = 2) + -->
<!--     theme_ridges() + -->
<!--     theme(legend.position = "none") , -->
<!--   post_dat %>% -->
<!--     filter(var == 'Dryweight') %>%  -->
<!--     ggplot(aes(value, eff, fill = eff)) +  -->
<!--     geom_vline(xintercept = 0, linetype = 2) +  -->
<!--     stat_halfeyeh(alpha = .8) + -->
<!--     scale_fill_brewer(palette = "Spectral") + -->
<!--     ylab(NULL) + -->
<!--     xlab("Effect on body weight (SDs)") +  -->
<!--     theme_ridges() + -->
<!--     theme(legend.position = "none") -->
<!--   heights = c(0.8,0.2) -->
<!-- ) -->
<!-- ``` -->
</div>
</div>
<div id="posterior-effect-size-of-treatment-on-metabolite-abundance-for-each-sex" class="section level2 tabset">
<h2>Posterior effect size of treatment on metabolite abundance, for each sex</h2>
<p>Here, we use the model to predict the… NEED TO DO THIS FOR DIFFERENT BODY SIZES TOO…</p>
<p>Text here…</p>
<div id="figure" class="section level3">
<h3>Figure</h3>
<pre class="r"><code>new &lt;- expand_grid(sex = c(&quot;Male&quot;, &quot;Female&quot;),
                   treatment = c(&quot;Monogamy&quot;, &quot;Polyandry&quot;),
                   Dryweight = 0, line = NA) %&gt;%
  mutate(type = 1:n())

levels &lt;- c(&quot;Carbohydrate&quot;, &quot;Chitin&quot;, &quot;Glycogen&quot;, &quot;Lipid&quot;, &quot;Protein&quot;, &quot;Dryweight&quot;)

# Predict data from the SEM of metabolites...
# Because we use sum contrasts for &quot;line&quot; and line=NA in the new data, 
# this predicts at the global means across the 4 lines (see ?posterior_epred)
fitted_values &lt;- posterior_epred(brms_metabolite_SEM, newdata = new, summary = FALSE) %&gt;% 
  reshape2::melt() %&gt;% rename(draw = Var1, type = Var2, variable = Var3) %&gt;% 
  as_tibble() %&gt;%
  left_join(new, by = &quot;type&quot;) %&gt;%
  select(draw, variable, value, sex, treatment) %&gt;%
  mutate(variable = factor(variable, levels))


treat_diff &lt;- fitted_values %&gt;%
  spread(treatment, value) %&gt;%
  mutate(`Difference in means (Poly - Mono)` = Polyandry - Monogamy) 


summary_dat1 &lt;- treat_diff %&gt;%
  filter(variable != &#39;Dryweight&#39;) %&gt;%
  rename(x = `Difference in means (Poly - Mono)`) %&gt;%
  group_by(variable, sex)  %&gt;%
  summarise(`Difference in means (Poly - Mono)` = median(x),
            `Lower 95% CI` = quantile(x, probs = 0.025), 
            `Upper 95% CI` = quantile(x, probs = 0.975),
            p = 1 - as.numeric(bayestestR::p_direction(x)),
            ` ` = ifelse(p &lt; 0.05, &quot;*&quot;, &quot;&quot;),
            .groups = &quot;drop&quot;)

sampled_draws &lt;- sample(unique(fitted_values$draw), 100)

treat_diff %&gt;%
  filter(variable != &#39;Dryweight&#39;) %&gt;% 
  ggplot(aes(x = sex, y = `Difference in means (Poly - Mono)`,fill = sex)) +
  geom_hline(yintercept = 0, linetype = 2) +
  stat_halfeye() + 
  geom_line(data = treat_diff %&gt;%
              filter(draw %in% sampled_draws) %&gt;%
              filter(variable != &#39;Dryweight&#39;), 
            alpha = 0.8, size = 0.12, colour = &quot;black&quot;, aes(group = draw)) +
  geom_point(data = summary_dat1, pch = 21, colour = &quot;black&quot;, size = 3.1) + 
  scale_fill_brewer(palette = &#39;Pastel1&#39;, direction = 1, name = &quot;&quot;) +
  scale_colour_brewer(palette = &#39;Pastel1&#39;, direction = 1, name = &quot;&quot;) +
  facet_wrap( ~ variable,  nrow = 1) +
  theme_bw() +
  theme(legend.position = &#39;none&#39;,
        strip.background = element_blank(),
        panel.grid.major.x = element_blank()) +
  coord_cartesian(ylim = c(-1.8, 1.8)) + 
  ylab(&quot;Difference in means between\nselection treatments (P - M)&quot;) + xlab(&quot;Sex&quot;)</code></pre>
<p><img src="figure/metabolites.Rmd/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="table" class="section level3">
<h3>Table</h3>
<pre class="r"><code>summary_dat1 %&gt;%
  kable(digits=3) %&gt;%
  kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
Difference in means (Poly - Mono)
</th>
<th style="text-align:right;">
Lower 95% CI
</th>
<th style="text-align:right;">
Upper 95% CI
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Carbohydrate
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
-0.275
</td>
<td style="text-align:right;">
-0.960
</td>
<td style="text-align:right;">
0.444
</td>
<td style="text-align:right;">
0.210
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Carbohydrate
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
-0.800
</td>
<td style="text-align:right;">
-1.439
</td>
<td style="text-align:right;">
-0.148
</td>
<td style="text-align:right;">
0.009
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Chitin
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
-0.262
</td>
<td style="text-align:right;">
-0.837
</td>
<td style="text-align:right;">
0.326
</td>
<td style="text-align:right;">
0.188
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Chitin
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
-0.614
</td>
<td style="text-align:right;">
-1.139
</td>
<td style="text-align:right;">
-0.091
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Glycogen
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
0.267
</td>
<td style="text-align:right;">
-0.386
</td>
<td style="text-align:right;">
0.969
</td>
<td style="text-align:right;">
0.209
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Glycogen
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
0.913
</td>
<td style="text-align:right;">
0.281
</td>
<td style="text-align:right;">
1.534
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Lipid
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
0.739
</td>
<td style="text-align:right;">
0.182
</td>
<td style="text-align:right;">
1.306
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Lipid
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
-0.007
</td>
<td style="text-align:right;">
1.018
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:left;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Protein
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
-0.605
</td>
<td style="text-align:right;">
-1.392
</td>
<td style="text-align:right;">
0.169
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Protein
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
0.230
</td>
<td style="text-align:right;">
-0.529
</td>
<td style="text-align:right;">
0.983
</td>
<td style="text-align:right;">
0.266
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="posterior-difference-in-treatment-effect-size-between-sexes" class="section level2 tabset">
<h2>Posterior difference in treatment effect size between sexes</h2>
<p>This section essentially examines the treatment <span class="math inline">\(\times\)</span> sex interaction term, by calculating the difference in the effect size of the P/M treatment between sexes, for each of the five metabolites. We find no strong evidence for a treatment <span class="math inline">\(\times\)</span> sex interaction, i.e. the treatment effects did not differ detectably between sexes. However, the effect of the Polyandry treatment on glycogen concentration appears to be marginally more positive in males than females (probability of direction = 92.5%, similar to a one-sided p-value of 0.075).</p>
<div id="figure-1" class="section level3">
<h3>Figure</h3>
<pre class="r"><code>treatsex_interaction_data &lt;- treat_diff %&gt;%
  select(draw, variable, sex, d =  `Difference in means (Poly - Mono)`) %&gt;%
  arrange(draw, variable, sex) %&gt;%
  group_by(draw, variable) %&gt;%
  summarise(`Difference in effect size between sexes` = d[2] - d[1],
            .groups = &quot;drop&quot;) # males - females


treatsex_interaction_data %&gt;%
  filter(variable != &#39;Dryweight&#39;) %&gt;% 
  ggplot(aes(x = `Difference in effect size between sexes`, y = 1, fill = stat((x) &lt; 0))) +
  geom_vline(xintercept = 0, linetype = 2) +
  stat_halfeyeh() +
  facet_wrap( ~ variable) +
  scale_fill_brewer(palette = &#39;Pastel2&#39;, direction = 1, name = &quot;&quot;) +
  theme_bw() +
  theme(legend.position = &#39;none&#39;,
        strip.background = element_blank()) +
  ylab(&quot;Posterior density&quot;)</code></pre>
<p><img src="figure/metabolites.Rmd/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="table-1" class="section level3">
<h3>Table</h3>
<pre class="r"><code>treatsex_interaction_data %&gt;%
  filter(variable != &#39;Dryweight&#39;) %&gt;%
  rename(x = `Difference in effect size between sexes`) %&gt;%
  group_by(variable)  %&gt;%
  summarise(`Difference in effect size between sexes` = median(x),
            `Lower 95% CI` = quantile(x, probs = 0.025), 
            `Upper 95% CI` = quantile(x, probs = 0.975),
            p = 1 - as.numeric(bayestestR::p_direction(x)),
            ` ` = ifelse(p &lt; 0.05, &quot;*&quot;, &quot;&quot;),
            .groups = &quot;drop&quot;) %&gt;%
  kable(digits=3) %&gt;%
  kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
Difference in effect size between sexes
</th>
<th style="text-align:right;">
Lower 95% CI
</th>
<th style="text-align:right;">
Upper 95% CI
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Carbohydrate
</td>
<td style="text-align:right;">
-0.523
</td>
<td style="text-align:right;">
-1.436
</td>
<td style="text-align:right;">
0.392
</td>
<td style="text-align:right;">
0.126
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Chitin
</td>
<td style="text-align:right;">
-0.355
</td>
<td style="text-align:right;">
-1.112
</td>
<td style="text-align:right;">
0.379
</td>
<td style="text-align:right;">
0.165
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Glycogen
</td>
<td style="text-align:right;">
0.639
</td>
<td style="text-align:right;">
-0.242
</td>
<td style="text-align:right;">
1.502
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Lipid
</td>
<td style="text-align:right;">
-0.240
</td>
<td style="text-align:right;">
-0.959
</td>
<td style="text-align:right;">
0.478
</td>
<td style="text-align:right;">
0.253
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Protein
</td>
<td style="text-align:right;">
0.841
</td>
<td style="text-align:right;">
-0.212
</td>
<td style="text-align:right;">
1.878
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre>R version 4.0.3 (2020-10-10)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Catalina 10.15.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] knitrhooks_0.0.4 knitr_1.30       kableExtra_1.1.0 tidybayes_2.0.3 
 [5] brms_2.14.4      Rcpp_1.0.4.6     nlme_3.1-149     ggridges_0.5.2  
 [9] gridExtra_2.3    GGally_1.5.0     forcats_0.5.0    stringr_1.4.0   
[13] dplyr_1.0.0      purrr_0.3.4      readr_1.3.1      tidyr_1.1.0     
[17] tibble_3.0.1     ggplot2_3.3.2    tidyverse_1.3.0  workflowr_1.6.2 

loaded via a namespace (and not attached):
  [1] readxl_1.3.1         backports_1.1.7      plyr_1.8.6          
  [4] igraph_1.2.5         svUnit_1.0.3         splines_4.0.3       
  [7] crosstalk_1.1.0.1    TH.data_1.0-10       rstantools_2.1.1    
 [10] inline_0.3.15        digest_0.6.25        htmltools_0.5.0     
 [13] rsconnect_0.8.16     fansi_0.4.1          magrittr_2.0.1      
 [16] modelr_0.1.8         RcppParallel_5.0.1   matrixStats_0.56.0  
 [19] xts_0.12-0           sandwich_2.5-1       prettyunits_1.1.1   
 [22] colorspace_1.4-1     blob_1.2.1           rvest_0.3.5         
 [25] haven_2.3.1          xfun_0.19            callr_3.4.3         
 [28] crayon_1.3.4         jsonlite_1.7.0       lme4_1.1-23         
 [31] survival_3.2-7       zoo_1.8-8            glue_1.4.2          
 [34] gtable_0.3.0         emmeans_1.4.7        webshot_0.5.2       
 [37] V8_3.4.0             pkgbuild_1.0.8       rstan_2.21.2        
 [40] abind_1.4-5          scales_1.1.1         mvtnorm_1.1-0       
 [43] DBI_1.1.0            miniUI_0.1.1.1       viridisLite_0.3.0   
 [46] xtable_1.8-4         stats4_4.0.3         StanHeaders_2.21.0-3
 [49] DT_0.13              htmlwidgets_1.5.1    httr_1.4.1          
 [52] DiagrammeR_1.0.6.1   threejs_0.3.3        arrayhelpers_1.1-0  
 [55] RColorBrewer_1.1-2   ellipsis_0.3.1       farver_2.0.3        
 [58] pkgconfig_2.0.3      reshape_0.8.8        loo_2.3.1           
 [61] dbplyr_1.4.4         labeling_0.3         tidyselect_1.1.0    
 [64] rlang_0.4.6          reshape2_1.4.4       later_1.0.0         
 [67] visNetwork_2.0.9     munsell_0.5.0        cellranger_1.1.0    
 [70] tools_4.0.3          cli_2.0.2            generics_0.0.2      
 [73] broom_0.5.6          evaluate_0.14        fastmap_1.0.1       
 [76] yaml_2.2.1           processx_3.4.2       fs_1.4.1            
 [79] whisker_0.4          mime_0.9             projpred_2.0.2      
 [82] xml2_1.3.2           compiler_4.0.3       bayesplot_1.7.2     
 [85] shinythemes_1.1.2    rstudioapi_0.11      gamm4_0.2-6         
 [88] curl_4.3             reprex_0.3.0         statmod_1.4.34      
 [91] stringi_1.5.3        highr_0.8            ps_1.3.3            
 [94] Brobdingnag_1.2-6    lattice_0.20-41      Matrix_1.2-18       
 [97] nloptr_1.2.2.1       markdown_1.1         shinyjs_1.1         
[100] vctrs_0.3.0          pillar_1.4.4         lifecycle_0.2.0     
[103] bridgesampling_1.0-0 estimability_1.3     insight_0.8.4       
[106] httpuv_1.5.3.1       R6_2.4.1             promises_1.1.0      
[109] codetools_0.2-16     boot_1.3-25          colourpicker_1.0    
[112] MASS_7.3-53          gtools_3.8.2         assertthat_0.2.1    
[115] rprojroot_1.3-2      withr_2.2.0          shinystan_2.5.0     
[118] multcomp_1.4-13      bayestestR_0.6.0     mgcv_1.8-33         
[121] parallel_4.0.3       hms_0.5.3            grid_4.0.3          
[124] coda_0.19-3          minqa_1.2.4          rmarkdown_2.5       
[127] git2r_0.27.1         shiny_1.4.0.2        lubridate_1.7.8     
[130] base64enc_0.1-3      dygraphs_1.1.1.6    
</pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
