<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Statistical analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="site_libs/viz-1.8.2/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.5/grViz.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">respiration_exp_evolution</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Statistical analysis</h1>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-03-09
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>respiration_exp_evolution/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.0). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20190703code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20190703)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20190703code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20190703)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanexpevolrespirationtree12a1f4f090d76502ce5a94aaa8ce2145f9e2a193targetblank12a1f4fa"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/lukeholman/exp_evol_respiration/tree/12a1f4f090d76502ce5a94aaa8ce2145f9e2a193" target="_blank">12a1f4f</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomlukeholmanexpevolrespirationtree12a1f4f090d76502ce5a94aaa8ce2145f9e2a193targetblank12a1f4fa" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility. The version displayed above was the version of the Git repository at the time these results were generated. <br><br> Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rapp.history
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    Supplementary tables and figures.docx
    Ignored:    analysis/.DS_Store
    Ignored:    data/.DS_Store
    Ignored:    data/top_model_files.rds
    Ignored:    manuscript.docx
    Ignored:    output/.DS_Store
    Ignored:    output/temp_files/
    Ignored:    ~$nuscript.docx

Untracked files:
    Untracked:  online_supp/
    Untracked:  output/flow_diagram.pdf
    Untracked:  output/mediation_figure_RQ.pdf
    Untracked:  output/mediation_figure_VO2.pdf
    Untracked:  output/pairs_plot.pdf
    Untracked:  output/posterior_means_plot.pdf
    Untracked:  ~$pplementary tables and figures.docx

Unstaged changes:
    Deleted:    output/Figure 2.pdf
    Modified:   output/brms_SEM.rds

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the R Markdown and HTML files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view them.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/12a1f4f090d76502ce5a94aaa8ce2145f9e2a193/analysis/statistics.Rmd" target="_blank">12a1f4f</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-09
</td>
<td>
another commit
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/0ae00205218606917b1be79848ea801f61643080/docs/statistics.html" target="_blank">0ae0020</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/df06126eba0c46825d4cc8806ba93e96da18d3e7/analysis/statistics.Rmd" target="_blank">df06126</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
tweak stats
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/df06126eba0c46825d4cc8806ba93e96da18d3e7/docs/statistics.html" target="_blank">df06126</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
tweak stats
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/8fe4fc96e11a231b3b6e90c4cc5b50d8a790be26/docs/statistics.html" target="_blank">8fe4fc9</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/bea659326d84e8a1e5797b5bab52bca74e7a6893/analysis/statistics.Rmd" target="_blank">bea6593</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
tweak stats
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/dbbbcb784ecb3180eed4df131c59c442f12415a3/docs/statistics.html" target="_blank">dbbbcb7</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/analysis/statistics.Rmd" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
quick test
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/0a357584eafe405ea523f32206de82e5ce5ad461/docs/statistics.html" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
<td>
quick test
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/27523526d153b1705871bfc150cb04416f53af88/analysis/statistics.Rmd" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
<td>
Almost reaedy
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/lukeholman/exp_evol_respiration/27523526d153b1705871bfc150cb04416f53af88/docs/statistics.html" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
<td>
Almost reaedy
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="load-r-packages" class="section level2">
<h2>Load R packages</h2>
<pre class="r"><code>library(tidyverse)
library(gridExtra)
library(grid)
library(brms)
library(RColorBrewer)
library(glue)
library(kableExtra)
library(tidybayes)
library(bayestestR)
library(MuMIn)
library(glue)
library(ggridges)
library(future)
library(future.apply)
library(GGally)

library(knitrhooks) # install with devtools::install_github(&quot;nathaneastwood/knitrhooks&quot;)

output_max_height() # a knitrhook option
options(stringsAsFactors = FALSE)

# Define function for the inverse logit
inv_logit &lt;- function(x) 1 / (1 + exp(-x))</code></pre>
</div>
<div id="load-respirometry-data" class="section level2">
<h2>Load respirometry data</h2>
<pre class="r"><code>respiration &lt;- read_csv(&quot;data/2.metabolic_rates.csv&quot;) %&gt;%
  rename(SELECTION = `?SELECTION`)</code></pre>
</div>
<div id="draw-the-flow-diagram" class="section level2">
<h2>Draw the flow diagram</h2>
<pre class="r"><code>DiagrammeR::grViz(&#39;digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

&quot;Metabolic\nrate&quot; [shape = oval, fillcolor = Beige]
&quot;Metabolic\nsubstrate&quot; [shape = oval, fillcolor = Beige]
&quot;Other factors\n(e.g. physiology)&quot; [shape = oval, fillcolor = Beige]

# edge definitions with the node IDs
&quot;Mating system\ntreatment (M vs P)&quot; -&gt; {&quot;Other factors\n(e.g. physiology)&quot;, &quot;Body mass&quot; , &quot;Activity&quot;} -&gt; {&quot;Metabolic\nrate&quot;, &quot;Metabolic\nsubstrate&quot;} 

{&quot;Metabolic\nrate&quot;} -&gt; {&quot;O\u2082 consumption&quot;, &quot;CO\u2082 production&quot;}
{&quot;O\u2082 consumption&quot;, &quot;CO\u2082 production&quot;} -&gt; &quot;Respiratory\nquotient (RQ)&quot;
{&quot;Metabolic\nsubstrate&quot;} -&gt; &quot;Respiratory\nquotient (RQ)&quot;
}&#39;)</code></pre>
<p><div id="htmlwidget-6ec5e240e3b68e9cc473" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ec5e240e3b68e9cc473">{"x":{"diagram":"digraph {\n\ngraph [layout = dot, rankdir = LR]\n\n# define the global styles of the nodes. We can override these in box if we wish\nnode [shape = rectangle, style = filled, fillcolor = Linen]\n\n\"Metabolic\nrate\" [shape = oval, fillcolor = Beige]\n\"Metabolic\nsubstrate\" [shape = oval, fillcolor = Beige]\n\"Other factors\n(e.g. physiology)\" [shape = oval, fillcolor = Beige]\n\n# edge definitions with the node IDs\n\"Mating system\ntreatment (M vs P)\" -> {\"Other factors\n(e.g. physiology)\", \"Body mass\" , \"Activity\"} -> {\"Metabolic\nrate\", \"Metabolic\nsubstrate\"} \n\n{\"Metabolic\nrate\"} -> {\"O₂ consumption\", \"CO₂ production\"}\n{\"O₂ consumption\", \"CO₂ production\"} -> \"Respiratory\nquotient (RQ)\"\n{\"Metabolic\nsubstrate\"} -> \"Respiratory\nquotient (RQ)\"\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script> <br></br> <strong>Figure 1:</strong> Directed acyclic graph (DAG) showing the key causal relationships that we hypothesised a priori between the measured variables (squares) and latent variables (ovals). This DAG motivated the Bayesian structural equation model discussed in the Methods and Results, which attempts to decompose the effects of treatment on respiration (measured via O2 and CO2 flux, and their ratio, RQ) into paths that travel via body mass, activity, or other unmeasured factors such as physiology.</p>
</div>
<div id="inspecting-the-raw-data" class="section level2">
<h2>Inspecting the raw data</h2>
<p>Create a “pairs plot” of the raw data.</p>
<pre class="r"><code>modified_densityDiag &lt;- function(data, mapping, ...) {
  ggally_densityDiag(data, mapping, ...) + scale_fill_brewer(type = &quot;qual&quot;, palette = &quot;Set1&quot;, direction = -1) + 
  scale_x_continuous(guide = guide_axis(check.overlap = TRUE))
}

modified_points &lt;- function(data, mapping, ...) {
  ggally_points(data, mapping, ...) + scale_colour_brewer(type = &quot;qual&quot;, palette = &quot;Set1&quot;, direction = -1) + 
  scale_x_continuous(guide = guide_axis(check.overlap = TRUE))
}

modified_facetdensity &lt;- function(data, mapping, ...) {
  ggally_facetdensity(data, mapping, ...) + scale_colour_brewer(type = &quot;qual&quot;, palette = &quot;Set1&quot;, direction = -1)
}

modified_box_no_facet &lt;- function(data, mapping, ...) {
  ggally_box_no_facet(data, mapping, ...) + scale_fill_brewer(type = &quot;qual&quot;, palette = &quot;Set1&quot;, direction = -1)
}

pairs_plot &lt;- respiration %&gt;% 
  select(SEX, SELECTION, CYCLE, VO2, VCO2, RQ, ACTIVITY, BODY_WEIGHT) %&gt;%
  mutate(VO2 = VO2 * 1000, 
         VCO2 = VCO2 * 1000, 
         BODY_WEIGHT = BODY_WEIGHT * 1000, 
         ACTIVITY = ACTIVITY * 100) %&gt;%
  mutate(SEX = factor(ifelse(SEX == &quot;M&quot;, &quot;Male&quot;, &quot;Female&quot;), c(&quot;Male&quot;, &quot;Female&quot;))) %&gt;%
  rename(Sex = SEX, Treatment = SELECTION, Cycle = CYCLE, 
         Activity = ACTIVITY, `Body mass` = BODY_WEIGHT) %&gt;%
  ggpairs(aes(colour = Treatment),
          diag = list(continuous = wrap(modified_densityDiag, alpha = 0.7),
                      discrete = wrap(&quot;blank&quot;)),
          lower = list(continuous = wrap(modified_points, alpha = 0.7, size = 0.5), 
                       discrete = wrap(&quot;blank&quot;),
                       combo = wrap(modified_box_no_facet, alpha = 0.7)),
          upper = list(continuous = wrap(modified_points, alpha = 0.7, size = 0.5),
                       discrete = wrap(&quot;blank&quot;),
                       combo = wrap(modified_facetdensity, alpha = 0.7, size = 0.5))) 

pairs_plot %&gt;% ggsave(filename = &quot;output/pairs_plot.pdf&quot;, height = 10, width = 10)
pairs_plot</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-4-1">
Past versions of unnamed-chunk-4-1.png
</button>
</p>
<div id="fig-unnamed-chunk-4-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/docs/figure/statistics.Rmd/unnamed-chunk-4-1.png" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/27523526d153b1705871bfc150cb04416f53af88/docs/figure/statistics.Rmd/unnamed-chunk-4-1.png" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Figure 2:</strong> Boxplots, scatterplots, and density plots illustrating the variance and covariance among the explanatory variables (Treatment, Sex, and Cycle) and the five response variables. The data are coloured by treatment (red for polyandry, blue for monogamy). The plot shows the raw data in their original units, namely the number of mm of O2 consumed or CO2 produced, the % time spent active, and the mass of the fly in milligrams (RQ is a ratio and thus has no units). Note that RQ has as expected range of 0.7-1.0 because of the chemistry of respiration, but values outside this range often occur due to measurement error for O2 and/or CO2.</p>
</div>
<div id="fit-the-first-brms-models-ignoring-the-moderator-variables" class="section level2">
<h2>Fit the first <code>brms</code> models, ignoring the moderator variables</h2>
<div id="scale-the-input-data" class="section level3">
<h3>Scale the input data</h3>
<p>Here, we scale and centre the body mass and activity (across all samples), and multiply VO2 and VCO2 by 1000 so that their units (and resulting regression coefficients) are close to those assumed by the <code>brms</code> default priors.</p>
<p>We did not scale and centre VO2 and VCO2, because we will soon relate them to each other via the respiratory quotient, RQ, so it makes sense to leave them in their original units rather than converting their units to standard deviations.</p>
<p>Note that body mass and activity are not actually used until the following section (i.e. <em>Fit the <code>brms</code> structural equation model (SEM)</em>).</p>
<pre class="r"><code>scaled_data &lt;- respiration %&gt;%
  mutate(VO2 = VO2 * 1000, 
         VCO2 = VCO2 * 1000,
         BODY_WEIGHT = as.numeric(scale(BODY_WEIGHT)),
         ACTIVITY = as.numeric(scale(ACTIVITY))) %&gt;% 
  rename(BODYMASS = BODY_WEIGHT)</code></pre>
</div>
<div id="write-out-the-full-models-formulae" class="section level3">
<h3>Write out the full model’s formulae</h3>
<p>Here, I write out all the formulae for the “full model”, as well as their equivalents for all the simpler models nested within the full model. All of these models contain more than one formula each (i.e. they are multivariate models): one formula for oxygen consumption (VO2) and one for CO2 production (VCO2), as well as a formula for the parameter RQ (the respiratory quotient, i.e. VCO2 / VO2). I assume that VO2 and RQ are both affected by the predictor variables that resukt from the experimental design, namely SELECTION (i.e. M vs P treatment), SEX (Male or Female), CYCLE (I, II, or III: this refers to the first, second, and third measurement of O2 and CO2 for each triad of flies), LINE (a random intercept term with 8 levels, one for each of the four independent replicates of the M an P treatmens), and SAMPLE (which identifies the three replicate measures of each triad of flies across the three cycles). The formulae for VO2 and VCO2 are as follows:</p>
<div id="vo2" class="section level4">
<h4>VO2</h4>
<p>Formula: <code>VO2 ~ SELECTION * SEX * CYCLE + (1 | LINE) + (1 | SAMPLE)</code></p>
<p>This formula allows for effects on VO2 of sex, selection and cycle (and all 2- and 3-way interactions), and models the variation in VO2 within and between each triad of flies and each replicate selection line (preventing pseudo-replication by properly accounting for our experimental design).</p>
</div>
<div id="vco2-as-determined-by-the-parameter-rq" class="section level4">
<h4>VCO2 (as determined by the parameter RQ)</h4>
<p>Formulae (2-part model, see <code>vignette(&quot;brms_nonlinear&quot;)</code>):</p>
<p><code>VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ))</code></p>
<p><code>RQ ~ SELECTION * SEX * CYCLE + (1 | LINE) + (1 | SAMPLE)</code></p>
<p>VCO2 is assumed to depend on the value of VO2 from the same measurement, multiplied by RQ, a parameter that is constrained to vary between 0.7 and 1 (based on our prior knowledge of the chemistry of respiration) through the use of the inverse logit function. In turn, RQ is assumed to depend on the same set of predictors as for VO2.</p>
</div>
<div id="priors" class="section level4">
<h4>Priors</h4>
<p>To apply some mild regularisation and assist model convergence, we set a prior on all the fixed effect parameters of <code>normal(0, 3)</code>.</p>
</div>
<div id="family" class="section level4">
<h4>Family</h4>
<p>All response variables are assumed to follow a normal (Gaussian) distribution.</p>
</div>
</div>
<div id="finding-all-the-sub-models-for-model-selection" class="section level3">
<h3>Finding all the sub-models for model selection</h3>
<p>Now that we have written out the full model, we can find all its component sub-models. This is complicated by the fact that it is a multivariate model, and so we need to find the sub-models for both VO2 and RQ, and then find all possible combinations of these.</p>
<pre class="r"><code># For convenience, we borrow the function `dredge()` from the MuMIn package, 
# and use it find all submodels
all_sub_models &lt;- paste(get.models(with(options(na.action = na.fail), 
                      dredge(lm(VO2 ~ SELECTION * SEX * CYCLE, data = scaled_data))), subset = TRUE) %&gt;%
  map_chr(~ as.character(.x$call)[2]) %&gt;% 
    unname() %&gt;% 
    str_remove_all(&quot; [+] 1&quot;) %&gt;% 
    str_remove_all(&quot;VO2 ~ &quot;), 
  &quot;+ (1 | LINE) + (1 | SAMPLE)&quot;) 

# Find all combinations of sub-model formulas for VO2 and RQ
combos &lt;- expand.grid(vo2 = all_sub_models, 
                      rq = all_sub_models, stringsAsFactors = FALSE)

# Write out the complete multi-part formulas for all 361 to be compared
write_formula &lt;- function(vo2, rq){
glue(&quot;
bf(VO2 ~ {vo2}) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ {rq}, nl = TRUE) + set_rescor(FALSE)&quot;) %&gt;% 
    as.character()
}

all_formulas &lt;- map2(combos[,1], 
                     combos[,2], 
                     write_formula)

print(&quot;Inspect the first few formulas:&quot;)</code></pre>
<pre>[1] "Inspect the first few formulas:"
</pre>
<pre class="r"><code>head(unlist(all_formulas))</code></pre>
<pre>[1] "bf(VO2 ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"                  
[2] "bf(VO2 ~ CYCLE + SELECTION + SEX + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"                                  
[3] "bf(VO2 ~ CYCLE + SELECTION + SEX + CYCLE:SELECTION + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"
[4] "bf(VO2 ~ CYCLE + SELECTION + SEX + CYCLE:SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"      
[5] "bf(VO2 ~ CYCLE + SELECTION + SEX + CYCLE:SELECTION + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"                
[6] "bf(VO2 ~ CYCLE + SELECTION + SEX + CYCLE:SEX + (1 | LINE) + (1 | SAMPLE)) + bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)), RQ ~ CYCLE + SELECTION + SEX + SELECTION:SEX + (1 | LINE) + (1 | SAMPLE), nl = TRUE) + set_rescor(FALSE)"                      
</pre>
</div>
<div id="run-all-the-brms-models-and-save-them-to-disk" class="section level3">
<h3>Run all the <code>brms</code> models and save them to disk</h3>
<p>Here, we run all 361 of the models whose formulae are given in the vector <code>all_formulas</code>, and save the results of each model to an external hard drive (this uses about 55GB). Note that the prior for each model is the same, except that one does not need to specify a prior on the fixed effects in models that do not contain any fixed effects, which is why the <code>if()</code> statements are needed.</p>
<pre class="r"><code># Function to run a model using formula number &quot;i&quot; in &quot;formula_list&quot; on dataframe &quot;my_data&quot;
run_model &lt;- function(i, formula_list, my_data){
  
  save_location &lt;- &quot;/Volumes/LACIE_SHARE/brms_respiration&quot;
  num &lt;- str_pad(i, 3, pad = &quot;0&quot;)
  file_name &lt;- glue(&quot;{save_location}/model_{num}.rds&quot;)
  if(file.exists(file_name)) return(NULL)
  
  focal_formula &lt;- eval(parse(text = formula_list[[i]]))
  
  if(!str_detect(focal_formula, &quot;VO2 ~ 1&quot;) &amp; !str_detect(focal_formula, &quot;RQ ~ 1&quot;)){
    model &lt;- brm(focal_formula, 
                 data = my_data, 
                 iter = 10000, chains = 4, cores = 1,
                 prior = c(prior(normal(0, 3), class = &quot;b&quot;, resp = &quot;VO2&quot;),
                           prior(normal(0, 3), class = &quot;b&quot;, resp = &quot;VCO2&quot;, nlpar = &quot;RQ&quot;)),
                 control = list(max_treedepth = 20, adapt_delta = 0.99),
                 save_all_pars = TRUE)
  } 
  if(!str_detect(focal_formula, &quot;VO2 ~ 1&quot;) &amp; str_detect(focal_formula, &quot;RQ ~ 1&quot;)){
    model &lt;- brm(focal_formula, 
                 data = my_data, 
                 iter = 10000, chains = 4, cores = 1,
                 prior = prior(normal(0, 3), class = &quot;b&quot;, resp = &quot;VO2&quot;),
                 control = list(max_treedepth = 20, adapt_delta = 0.99),
                 save_all_pars = TRUE)
  }
  if(str_detect(focal_formula, &quot;VO2 ~ 1&quot;) &amp; !str_detect(focal_formula, &quot;RQ ~ 1&quot;)){
    model &lt;- brm(focal_formula, 
                 data = my_data, 
                 iter = 10000, chains = 4, cores = 1,
                 prior = prior(normal(0, 3), class = &quot;b&quot;, resp = &quot;VCO2&quot;, nlpar = &quot;RQ&quot;),
                 control = list(max_treedepth = 20, adapt_delta = 0.99),
                 save_all_pars = TRUE)
  }
  if(str_detect(focal_formula, &quot;VO2 ~ 1&quot;) &amp; str_detect(focal_formula, &quot;RQ ~ 1&quot;)){
    model &lt;- brm(focal_formula, 
                 data = my_data, 
                 iter = 10000, chains = 4, cores = 1,
                 control = list(max_treedepth = 20, adapt_delta = 0.99),
                 save_all_pars = TRUE)
  }
  
  saveRDS(model, file = file_name)
  rm(model) # Force clean up to help R not run out of memory
  gc()
  return(NULL)
}

# Run all the models in parallel over 4 cores - this worked fine on a 2015 iMac with 32GB RAM
options(mc.cores=4)
plan(multiprocess)

future_lapply(1:length(all_formulas), 
              run_model, 
              formula_list = all_formulas, 
              my_data = scaled_data)</code></pre>
</div>
<div id="compare-all-the-fitted-brms-models-using-leave-one-out-cross-validation-loo" class="section level3">
<h3>Compare all the fitted <code>brms</code> models using leave-one-out cross validation (LOO)</h3>
<p>It is not possible to load all the models without running out of memory, so I here use a simple algorithm to select the top 10 models. The algorithm picks 20 candidate models at random, ranks them using LOO, and then removes the 10 worst-fitting models from the list of models under comparison. This is repeated until only 10 models remain - these are the 10 best-fitting models as ranked by LOO (under the PSIS-LOO approximation; see the <code>loo</code> package documentation and papers by Aki Vehtari and colleagues).</p>
<pre class="r"><code>if(!file.exists(&quot;data/model_selection_table.rds&quot;)){
  
  # Get the file names of the 361 models
  out_files &lt;- list.files(&quot;/Volumes/LACIE_SHARE/brms_respiration&quot;, full.names = TRUE)
  
  # Algorithm to pick the top 10 models without running out of memory
  while(length(out_files) &gt; 20){
    
    # Pick 20 random models that have not yet been eliminated
    sampled_files &lt;- sample(out_files, 20)
    
    # Rank all 20 models using LOO cross-validation
    weights &lt;- model_weights(
      readRDS(sampled_files[1]), readRDS(sampled_files[2]),
      readRDS(sampled_files[3]), readRDS(sampled_files[4]),
      readRDS(sampled_files[5]), readRDS(sampled_files[6]),
      readRDS(sampled_files[7]), readRDS(sampled_files[8]),
      readRDS(sampled_files[9]), readRDS(sampled_files[10]),
      readRDS(sampled_files[11]), readRDS(sampled_files[12]),
      readRDS(sampled_files[13]), readRDS(sampled_files[14]),
      readRDS(sampled_files[15]), readRDS(sampled_files[16]),
      readRDS(sampled_files[17]), readRDS(sampled_files[18]),
      readRDS(sampled_files[19]), readRDS(sampled_files[20]),
      weights = &quot;loo&quot;)
    
    # Discard all but the 10 top-ranked models from the set still to be compared
    to_keep &lt;- sampled_files[order(weights, decreasing=TRUE)[1:10]]
    to_remove &lt;- sampled_files[!(sampled_files %in% to_keep)]
    out_files &lt;- out_files[!(out_files %in% to_remove)]
    print(paste(length(out_files), &quot;left to compare&quot;))
  }
  
  top_model_files &lt;- out_files
  saveRDS(top_model_files, &quot;data/top_model_files.rds&quot;)
  
  # Get the weights for the top 10 models
  resp_model_weights &lt;- model_weights(
    readRDS(top_model_files[1]), readRDS(top_model_files[2]),
    readRDS(top_model_files[3]), readRDS(top_model_files[4]),
    readRDS(top_model_files[5]), readRDS(top_model_files[6]),
    readRDS(top_model_files[7]), readRDS(top_model_files[8]),
    readRDS(top_model_files[9]), readRDS(top_model_files[10]),
    weights = &quot;loo&quot;
  )
  
  # Format them nicely in a table
  resp_model_weights &lt;- round(resp_model_weights, 3) 
  names(resp_model_weights) &lt;- out_files[as.numeric(str_extract(names(resp_model_weights), &quot;[:digit:]+&quot;))]
  names(resp_model_weights) &lt;- all_formulas[as.numeric(str_extract(names(resp_model_weights), &quot;[:digit:]+&quot;))]
  
  ction_table &lt;- enframe(resp_model_weights, name = &quot;Model&quot;, value = &quot;LOO model weight&quot;) %&gt;%
    arrange(-`LOO model weight`) %&gt;%
    mutate(Model = str_remove_all(Model, &quot; \\+ \\(1 \\| LINE\\) \\+ \\(1 \\| SAMPLE\\)\\) \\+ bf\\(&quot;),
           Model = str_remove_all(Model, &quot;bf\\(&quot;),
           Model = str_remove_all(Model, &quot;~ VO2 \\* \\(0.7 \\+ 0.3 \\* inv_logit\\(RQ\\)\\), &quot;),
           Model = str_remove_all(Model, &quot; \\+ \\(1 \\| LINE\\) \\+ \\(1 \\| SAMPLE\\), nl = TRUE\\) \\+ set_rescor\\(FALSE\\)&quot;)) %&gt;%
    mutate(split = strsplit(Model, split = &quot; RQ&quot;),
           `Model of VO2` = map_chr(split, ~ .x[1]),
           `Model of RQ` = map_chr(split, ~ .x[2])) %&gt;%
    mutate(`Model of VO2` = str_remove_all(`Model of VO2`, &quot;VO2 &quot;),
           `Model of VO2` = str_remove_all(`Model of VO2`, &quot;VCO2&quot;),
           `Model of RQ` = str_replace_all(`Model of RQ`, &quot; ~&quot;, &quot;~&quot;)) %&gt;%
    select(`Model of VO2`, `Model of RQ`, `LOO model weight`) 
  
  saveRDS(model_selection_table, file = &quot;data/model_selection_table.rds&quot;)
} else {
  top_model_files &lt;- readRDS(&quot;data/top_model_files.rds&quot;)
  model_selection_table &lt;- readRDS(&quot;data/model_selection_table.rds&quot;)
}</code></pre>
<div id="model-selection-table" class="section level4">
<h4>Model selection table</h4>
<p>This table shows the top ten models from the set of 361 that was compared. The models were compared using leave-one-out cross validation (LOO), which is similar to more familiar metrics like AIC, but is regarded as the current best method for comparing the fit of a set of Bayesian models (see the documentation in <code>brms</code> and <code>loo</code> packages).</p>
<pre class="r"><code>library(formattable)

model_selection_table %&gt;%
  mutate_if(is.character, ~ str_replace_all(.x, &quot;CYCLE&quot;, &quot;Cycle&quot;)) %&gt;%
  mutate_if(is.character, ~ str_replace_all(.x, &quot;SELECTION&quot;, &quot;Selection&quot;)) %&gt;%
  mutate_if(is.character, ~ str_replace_all(.x, &quot;SEX&quot;, &quot;Sex&quot;)) %&gt;%
  mutate(`LOO model weight` = color_bar(&quot;lightgreen&quot;)(`LOO model weight`)) %&gt;%
  kable(escape = F, full.width = FALSE) %&gt;% kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model of VO2
</th>
<th style="text-align:left;">
Model of RQ
</th>
<th style="text-align:left;">
LOO model weight
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
~ Cycle + Sex + Cycle:Sex
</td>
<td style="text-align:left;">
~ Cycle
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 100.00%">0.381</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Selection + Sex + Cycle:Sex
</td>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 54.86%">0.209</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Selection + Sex + Selection:Sex
</td>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 49.61%">0.189</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
~ Cycle
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 25.98%">0.099</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 16.54%">0.063</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
~ Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 8.92%">0.034</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Selection + Sex
</td>
<td style="text-align:left;">
~ Cycle + Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 2.10%">0.008</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Selection + Sex + Cycle:Selection
</td>
<td style="text-align:left;">
~ 1
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 2.10%">0.008</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Selection + Sex + Cycle:Selection
</td>
<td style="text-align:left;">
~ Cycle
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 1.31%">0.005</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
~ Cycle + Sex + Cycle:Sex
</td>
<td style="text-align:left;">
~ Sex
</td>
<td style="text-align:left;">
<span style="display: inline-block; direction: rtl; border-radius: 4px; padding-right: 2px; background-color: lightgreen; width: 1.31%">0.005</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="inspect-the-parameter-estimates" class="section level3">
<h3>Inspect the parameter estimates</h3>
<div id="perform-bayesian-model-averaging" class="section level4">
<h4>Perform Bayesian model averaging</h4>
<p>Since there is no model that was strongly preferred to all the others, we here perform model averaging to calculate the parameter estimates for all the fixed effects that were present in at least 1 of the top 3 models. Parameters that were not present in all models were set to zero for models that lacked that parameter: this is sometimes called “full model averaging” (see e.g. ?MuMIn::model.avg), and it applies “shrinkage”, meaning that parameters that are not present in all of the top models get shrunk somewhat towards zero. The models are averaged according to their “stacking weights”, which is the current state-of-the-art for Bayesian model averaging (see e.g. <a href="https://mc-stan.org/loo/articles/loo2-weights.html">here</a>).</p>
<pre class="r"><code>avg &lt;- posterior_average(
  readRDS(top_model_files[1]), readRDS(top_model_files[2]), readRDS(top_model_files[3]),
  weights = &quot;stacking&quot;, missing = 0) %&gt;%
  select(contains(&quot;b_&quot;), contains(&quot;sd_&quot;))

make_model_summary_table &lt;- function(posterior_samples){
  pvalues &lt;- summarise_all(posterior_samples, p_direction) %&gt;% 
    gather(key, p) %&gt;%
    mutate(p = 1 - p) %&gt;%
    mutate(` ` = ifelse(p &lt; 0.05, &quot;\\*&quot;, &quot;&quot;),
           ` ` = replace(` `, p &gt; 0.05 &amp; p &lt; 0.1, &quot;~&quot;),
           ` ` = replace(` `, p &lt; 0.01, &quot;**&quot;), 
           ` ` = replace(` `, p &lt; 0.001, &quot;***&quot;))
  
  posterior_samples %&gt;%
    summarise_all(~ list(posterior_summary(.x)))  %&gt;% gather() %&gt;% 
    mutate(Estimate = map_dbl(value, ~ .x[1]),
           Error = map_dbl(value, ~ .x[2]),
           Q2.5 = map_dbl(value, ~ .x[3]),
           Q97.5 = map_dbl(value, ~ .x[4])) %&gt;% 
    select(-value) %&gt;%
    left_join(pvalues, by = &quot;key&quot;) %&gt;%
    mutate_if(is.numeric, ~ round(.x, 3)) %&gt;%
    mutate(p = replace(p, grepl(&quot;sd_&quot;, key), &quot; &quot;),
           p = replace(p, grepl(&quot;sigma_&quot;, key), &quot; &quot;),
           p = replace(p, grepl(&quot;Intercept_&quot;, key), &quot; &quot;),
           ` ` = replace(` `, grepl(&quot;sd_&quot;, key), &quot; &quot;),
           ` ` = replace(` `, grepl(&quot;sigma_&quot;, key), &quot; &quot;),
           ` ` = replace(` `, grepl(&quot;Intercept_&quot;, key), &quot; &quot;))
}</code></pre>
</div>
</div>
<div id="inspect-tables-of-results" class="section level3 tabset">
<h3>Inspect tables of results</h3>
<p>Here we present the model-averaged estimates for each of the fixed effects, as well as the results for the top model that contained our most interesting predictor, namely the M vs P selection treatment (i.e. the second-best model in the model selection table).</p>
<div id="results-from-model-averaging" class="section level4">
<h4>Results from model averaging</h4>
<pre class="r"><code>model_averaging_results &lt;- avg %&gt;%
  select(-starts_with(&quot;r_&quot;), -starts_with(&quot;z_&quot;), -starts_with(&quot;lp&quot;), -starts_with(&quot;sd_&quot;)) %&gt;% 
  make_model_summary_table() %&gt;%
  mutate(key = str_remove_all(key, &quot;b_&quot;),
         split = strsplit(key, split = &quot;_&quot;),
         resp = map_chr(split, ~ .x[1]),
         Parameter = map_chr(split, ~ tail(.x, 1)),
         resp = replace(resp, resp == &quot;VCO2&quot;, &quot;RQ&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEIII&quot;, &quot;Cycle (III)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEII&quot;, &quot;Cycle (II)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;SEXM&quot;, &quot;Sex (M)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEIII:SEXM&quot;, &quot;Cycle (III) x Sex (M)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEII:SEXM&quot;, &quot;Cycle (II) x Sex (M)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;SELECTIONPoly:SEXM&quot;, &quot;Treatment (P) x Sex (M)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;SELECTIONPoly&quot;, &quot;Treatment (P)&quot;)) %&gt;%
  select(resp, Parameter, everything()) %&gt;% select(-split, -key) %&gt;%
  arrange(desc(resp))

saveRDS(model_averaging_results, &quot;online_supp/model_averaging_results.rds&quot;)


model_averaging_results %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
resp
</th>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
<th style="text-align:left;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
7.627
</td>
<td style="text-align:right;">
0.632
</td>
<td style="text-align:right;">
6.382
</td>
<td style="text-align:right;">
8.910
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (II)
</td>
<td style="text-align:right;">
-0.903
</td>
<td style="text-align:right;">
0.235
</td>
<td style="text-align:right;">
-1.359
</td>
<td style="text-align:right;">
-0.443
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (III)
</td>
<td style="text-align:right;">
-1.984
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
-2.444
</td>
<td style="text-align:right;">
-1.525
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Treatment (P)
</td>
<td style="text-align:right;">
1.079
</td>
<td style="text-align:right;">
0.857
</td>
<td style="text-align:right;">
-0.653
</td>
<td style="text-align:right;">
2.714
</td>
<td style="text-align:left;">
0.096
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Sex (M)
</td>
<td style="text-align:right;">
-1.485
</td>
<td style="text-align:right;">
0.560
</td>
<td style="text-align:right;">
-2.591
</td>
<td style="text-align:right;">
-0.416
</td>
<td style="text-align:left;">
0.004
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Treatment (P) x Sex (M)
</td>
<td style="text-align:right;">
0.950
</td>
<td style="text-align:right;">
0.806
</td>
<td style="text-align:right;">
-0.259
</td>
<td style="text-align:right;">
2.541
</td>
<td style="text-align:left;">
0.226
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (II) x Sex (M)
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (III) x Sex (M)
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.303
</td>
<td style="text-align:right;">
0.301
</td>
<td style="text-align:right;">
-0.278
</td>
<td style="text-align:right;">
0.915
</td>
<td style="text-align:left;">
0.136
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Cycle (II)
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.230
</td>
<td style="text-align:right;">
-0.383
</td>
<td style="text-align:right;">
0.521
</td>
<td style="text-align:left;">
0.39
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Cycle (III)
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
-0.482
</td>
<td style="text-align:right;">
0.494
</td>
<td style="text-align:left;">
0.498
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Sex (M)
</td>
<td style="text-align:right;">
0.160
</td>
<td style="text-align:right;">
0.278
</td>
<td style="text-align:right;">
-0.388
</td>
<td style="text-align:right;">
0.706
</td>
<td style="text-align:left;">
0.275
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="results-from-the-individual-top-model-containing-selection" class="section level4">
<h4>Results from the individual top model containing selection</h4>
<pre class="r"><code>top_model_with_selection &lt;- posterior_samples(readRDS(top_model_files[2])) %&gt;%
  select(-starts_with(&quot;r_&quot;), -starts_with(&quot;z_&quot;), -starts_with(&quot;lp&quot;), 
         -starts_with(&quot;Intercept_&quot;), -starts_with(&quot;sd_&quot;), -starts_with(&quot;sigma_&quot;)) %&gt;% 
  make_model_summary_table() %&gt;%
  mutate(key = str_remove_all(key, &quot;b_&quot;),
         split = strsplit(key, split = &quot;_&quot;),
         resp = map_chr(split, ~ .x[1]),
         Parameter = map_chr(split, ~ tail(.x, 1)),
         resp = replace(resp, resp == &quot;VCO2&quot;, &quot;RQ&quot;),
         Parameter = replace(Parameter, Parameter == &quot;SELECTIONPoly&quot;, &quot;Treatment (P)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEIII&quot;, &quot;Cycle (III)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;CYCLEII&quot;, &quot;Cycle (II)&quot;),
         Parameter = replace(Parameter, Parameter == &quot;SEXM&quot;, &quot;Sex (M)&quot;)) %&gt;%
  select(resp, Parameter, everything()) %&gt;% select(-split, -key)
  
saveRDS(top_model_with_selection, &quot;online_supp/top_model_with_selection.rds&quot;)

top_model_with_selection %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
resp
</th>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
<th style="text-align:left;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
7.405
</td>
<td style="text-align:right;">
0.619
</td>
<td style="text-align:right;">
6.211
</td>
<td style="text-align:right;">
8.679
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (II)
</td>
<td style="text-align:right;">
-0.901
</td>
<td style="text-align:right;">
0.233
</td>
<td style="text-align:right;">
-1.354
</td>
<td style="text-align:right;">
-0.437
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Cycle (III)
</td>
<td style="text-align:right;">
-1.983
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:right;">
-2.445
</td>
<td style="text-align:right;">
-1.522
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Treatment (P)
</td>
<td style="text-align:right;">
1.521
</td>
<td style="text-align:right;">
0.768
</td>
<td style="text-align:right;">
-0.095
</td>
<td style="text-align:right;">
3.006
</td>
<td style="text-align:left;">
0.029
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left;">
VO2
</td>
<td style="text-align:left;">
Sex (M)
</td>
<td style="text-align:right;">
-1.017
</td>
<td style="text-align:right;">
0.406
</td>
<td style="text-align:right;">
-1.830
</td>
<td style="text-align:right;">
-0.216
</td>
<td style="text-align:left;">
0.008
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.305
</td>
<td style="text-align:right;">
0.305
</td>
<td style="text-align:right;">
-0.278
</td>
<td style="text-align:right;">
0.929
</td>
<td style="text-align:left;">
0.138
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Cycle (II)
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
0.233
</td>
<td style="text-align:right;">
-0.390
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:left;">
0.394
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Cycle (III)
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
-0.486
</td>
<td style="text-align:right;">
0.488
</td>
<td style="text-align:left;">
0.499
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
RQ
</td>
<td style="text-align:left;">
Sex (M)
</td>
<td style="text-align:right;">
0.157
</td>
<td style="text-align:right;">
0.281
</td>
<td style="text-align:right;">
-0.399
</td>
<td style="text-align:right;">
0.705
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="plot-the-parameter-estimates" class="section level3 tabset">
<h3>Plot the parameter estimates</h3>
<p>Again, we plot the estimates for model averaging, or the top model that contained selection treatment. We do not plot the estimates for RQ, since none of the parameter estimates clearly differed from zero.</p>
<div id="model-averaged-estimates" class="section level4">
<h4>Model averaged estimates</h4>
<pre class="r"><code>name_converter &lt;- tibble(
  new_name = c(&quot;O2: Male sex&quot;, &quot;O2: P treatment&quot;, &quot;O2: Cycle II&quot;, &quot;O2: Cycle III&quot;,
               &quot;O2: Male x Cycle II interaction&quot;, &quot;O2: Male x Cycle III interaction&quot;,
               &quot;RQ: Male sex&quot;, &quot;RQ: Cycle II&quot;, &quot;RQ: Cycle III&quot;),
  old_name = c(&quot;VO2_SEXM&quot;, &quot;VO2_SELECTIONPoly&quot;, &quot;VO2_CYCLEII&quot;, &quot;VO2_CYCLEIII&quot;,
               &quot;VO2_CYCLEII:SEXM&quot;, &quot;VO2_CYCLEIII:SEXM&quot;,
               &quot;VCO2_RQ_SEXM&quot;, &quot;VCO2_RQ_CYCLEII&quot;, &quot;VCO2_RQ_CYCLEIII&quot;)
) %&gt;% mutate(new_name = factor(new_name, rev(new_name)))

overall_SD_VO2 &lt;- scaled_data$VO2 %&gt;% sd()

plotter &lt;- function(posterior_samples){
  
  posterior_samples %&gt;% 
    as_tibble() %&gt;%
    select(contains(&quot;b_&quot;), -contains(&quot;Intercept&quot;)) %&gt;%
    gather() %&gt;% 
    mutate(key = str_remove_all(key, &quot;b_&quot;)) %&gt;%
    left_join(name_converter, by = c(&quot;key&quot; = &quot;old_name&quot;)) %&gt;%
    mutate(variable = ifelse(grepl(&quot;O2&quot;, new_name), &quot;O2&quot;, &quot;RQ&quot;)) %&gt;%
    filter(variable == &quot;O2&quot;) %&gt;%
    mutate(new_name = factor(str_remove(as.character(new_name), &quot;O2: &quot;),
                             rev(unique(str_remove(as.character(new_name), &quot;O2: &quot;))))) %&gt;%
    mutate(value = value / overall_SD_VO2) %&gt;%
    ggplot(aes(value, new_name, fill = new_name)) + 
    geom_vline(xintercept = 0, linetype = 2) + 
    geom_density_ridges(alpha = 0.7) +
    scale_fill_brewer(palette = &quot;Spectral&quot;) +
    ylab(&quot;Model parameter&quot;) +
    xlab(&quot;Effect on O2 consumption (SD)&quot;) + 
    theme_ridges() +
    theme(legend.position = &quot;none&quot;) +
    coord_cartesian(xlim = c(-1.4, 1.7))
}

plotter(avg)</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-13-1">
Past versions of unnamed-chunk-13-1.png
</button>
</p>
<div id="fig-unnamed-chunk-13-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/docs/figure/statistics.Rmd/unnamed-chunk-13-1.png" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/27523526d153b1705871bfc150cb04416f53af88/docs/figure/statistics.Rmd/unnamed-chunk-13-1.png" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="estimates-from-the-individual-top-model-containing-selection" class="section level4">
<h4>Estimates from the individual top model containing selection</h4>
<pre class="r"><code>plotter(readRDS(top_model_files[2]))</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-14-1">
Past versions of unnamed-chunk-14-1.png
</button>
</p>
<div id="fig-unnamed-chunk-14-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/docs/figure/statistics.Rmd/unnamed-chunk-14-1.png" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/27523526d153b1705871bfc150cb04416f53af88/docs/figure/statistics.Rmd/unnamed-chunk-14-1.png" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="plot-posterior-predictive-checks" class="section level3">
<h3>Plot posterior predictive checks</h3>
<p>Finally, we check that the values predicted by the (second-top) model resemble the real data (which they should, if the model is an adequate approximation of the true ‘data-generating processes’). This is done by drawing 10 samples from the posterior of the model, and using them to produce some new data (here, for VO2). The plot looks good, because the predicted data look similar to the original data, which is a necessary condiction for reliable inference.</p>
<pre class="r"><code>pp_check(readRDS(top_model_files[2]), resp = &quot;VO2&quot;)</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-15-1">
Past versions of unnamed-chunk-15-1.png
</button>
</p>
<div id="fig-unnamed-chunk-15-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/docs/figure/statistics.Rmd/unnamed-chunk-15-1.png" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
</tr>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/27523526d153b1705871bfc150cb04416f53af88/docs/figure/statistics.Rmd/unnamed-chunk-15-1.png" target="_blank">2752352</a>
</td>
<td>
lukeholman
</td>
<td>
2020-01-17
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="fit-the-brms-structural-equation-model-sem" class="section level2">
<h2>Fit the <code>brms</code> structural equation model (SEM)</h2>
<p>This next section fits a more complex version of previous multivariate model, which additionally includes the “mediator variables” (for definition, see e.g. <a href="https://en.wikipedia.org/wiki/Mediation_(statistics)">Wikipedia</a>) body mass and activity. The mediator variables potentially vary between sexes and selection treatments (and cycle, in the case of activity, but not body size), but they also potentially affect the main response variables, VO2 and RQ. Therefore, body mass and activity potentially “mediate” the effect of treatment, sex, and cycle on respiration. Using a structural equation model, one can partition an effect (e.g. the effect of treatment on respiration) into the share that is due to mediation vs other processes. For a good introduction to causal inference using Bayesian statistics, see <a href="https://www.youtube.com/watch?v=0Jc6Kgw5qc0&amp;list=PLDcUM9US4XdNM4Edgs7weiyIguLSToZRI&amp;index=7">this video lecture</a> and others in that series.</p>
<p>To limit the complexity of this already complex analysis, we forego a model selection step and simply fit the full model and analyse it.</p>
<div id="formulae-in-the-structural-equation-model" class="section level3">
<h3>Formulae in the structural equation model</h3>
<p>The SEM contains two additional formulae than the previous model, as well as additional predictor variables.</p>
<p>There is a sub-model for both of the mediator variables (activity and body mass), a model of oxygen production (VO2), and a model of CO2 production (VCO2, which is related to VO2 via the parameter RQ, the respiratory quotient, which the model also estimates).</p>
<p>The formulae were chosen <em>a priori</em>, to reflect our biological intuition about the direction of causality, and the factors that might affect each response variable.</p>
<div id="activity-level-one-value-per-cycle-i.e.3-measures-on-each-sample-of-individuals" class="section level4">
<h4>Activity level (one value per cycle, i.e. 3 measures on each ‘sample’ of individuals)</h4>
<p>Formula: <code>ACTIVITY ~ SELECTION * SEX + CYCLE + (1 | LINE) + (1 | SAMPLE)</code></p>
<p>This formula allows for effects on activity of sex and selection treatment (and their 2-way interaction), and for an effect of cycle (coded as a 3-level factor, allowing non-linear change across the 3 cycles). The random factors were added due to our repeated measures of replicate selection lines and samples (same for the following forrmulae).</p>
</div>
<div id="body-mass" class="section level4">
<h4>Body mass</h4>
<p>Formula: <code>BODYMASS ~ SELECTION * SEX + (1 | LINE)</code></p>
<p>This formula allows for effects on activity of sex and selection treatment (and their 2-way interaction). Because there is only one measure of body mass for each sample of flies, we do not need to fit a sample-level random effect; also, this model is run on only a subset of the full dataset (one of the 3 cycles), since we would incur pseudo-replication if we used the full dataset. Note that this means there is less replication for body mass than for the other variables, and so the parameter estimates are less precise for this model (visible in the figures plotted later).</p>
</div>
<div id="vo2-1" class="section level4">
<h4>VO2</h4>
<p>Formula: <code>VO2 ~ SELECTION * SEX * CYCLE + BODYMASS + ACTIVITY +</code><br />
<code>SELECTION:BODYMASS + SELECTION:ACTIVITY +</code> <code>SEX:BODYMASS + SEX:ACTIVITY + (1 | LINE) + (1 | SAMPLE)</code></p>
<p>This formula allows for effects on activity of sex, selection and cycle (and their 2- and 3-way interactions), and for sex- and selection treatment-specific effects of body mass and activity level.</p>
</div>
<div id="vco2-as-determined-by-the-parameter-rq-1" class="section level4">
<h4>VCO2 (as determined by the parameter RQ)</h4>
<p>Formulae (2-part model, see <code>vignette(&quot;brms_nonlinear&quot;)</code>):</p>
<p><code>VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ))</code></p>
<p><code>RQ ~ SELECTION * SEX * CYCLE + BODYMASS + ACTIVITY +</code><br />
<code>SELECTION:BODYMASS + SELECTION:ACTIVITY +</code> <code>SEX:BODYMASS + SEX:ACTIVITY + (1 | LINE) + (1 | SAMPLE)</code></p>
<p>VCO2 is assumed to depend on the value of VO2 from the same measurement, multiplied by RQ, a parameter that is constrained to vary between 0.7 and 1 (based on our prior knowledge of the chemistry of respiration) through the use of the inverse logit function. In turn, RQ is assumed to depend on the same set of predictors as for VO2.</p>
</div>
<div id="priors-1" class="section level4">
<h4>Priors</h4>
<p>To apply some mild regularisation and assist model convergence, we set a prior on all the fixed effect parameters of <code>normal(0, 3)</code>.</p>
</div>
<div id="family-1" class="section level4">
<h4>Family</h4>
<p>All response variables are assumed to follow a normal (Gaussian) distribution, except for activity level (which follows a beta distribution); as we shall see, this turns out to be a reasonable approximation of the response variables’ true distributions.</p>
</div>
</div>
<div id="fit-the-brms-model" class="section level3">
<h3>Fit the <code>brms</code> model</h3>
<pre class="r"><code># add a subsetting variable, so that we can estimate the effects of selection and sex 
# on body size without having three redundant measures of body size (one per cycle). 
# See ?brmsformula, section beginning &quot;For multivariate models, subset may be used...&quot;
scaled_data &lt;- scaled_data %&gt;%
  mutate(body_subset = CYCLE == &quot;I&quot;)    

if(!file.exists(&quot;output/brms_SEM.rds&quot;)){
  
  # Set up formula for the SEM:
  brms_formula &lt;- 
    
    bf(VO2 ~ SELECTION * SEX * CYCLE +  # VO2 sub-model
         BODYMASS + ACTIVITY +  
         SELECTION:BODYMASS + SELECTION:ACTIVITY + 
         SEX:BODYMASS + SEX:ACTIVITY + 
         (1 | LINE) + (1 | SAMPLE)) +
    
    bf(VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)),   # VCO2 and RQ sub-models
       RQ ~ SELECTION * SEX * CYCLE + 
         BODYMASS + ACTIVITY + 
         SELECTION:BODYMASS + SELECTION:ACTIVITY + 
         SEX:BODYMASS + SEX:ACTIVITY + 
         (1 | LINE) + (1 | SAMPLE),
       nl = TRUE) +
    
    bf(BODYMASS | subset(body_subset) ~ SELECTION * SEX + # body mass sub-model
         (1 | LINE)) +
    
    bf(ACTIVITY ~ SELECTION * SEX * CYCLE +   # activity sub-model
         (1 | LINE) + (1 | SAMPLE)) +   # , family = &quot;beta&quot;
    
    set_rescor(FALSE)
  
  # Run the SEM:
  brms_SEM &lt;- brm(
    brms_formula,  
    data = scaled_data,
    iter = 10000, chains = 4, cores = 1,
    prior = prior(normal(0, 1), class = &quot;b&quot;),
    control = list(max_treedepth = 20, adapt_delta = 0.999)
  )
  
  saveRDS(brms_SEM, file = &quot;output/brms_SEM.rds&quot;)
  
} else {
  brms_SEM &lt;- readRDS(&quot;output/brms_SEM.rds&quot;)
}</code></pre>
</div>
<div id="inspect-the-model-output" class="section level3">
<h3>Inspect the model output</h3>
<p>Here is the complete output of <code>summary()</code> called on the SEM. Note that the model has converged (Rhat = 1), and that no parameters are under-sampled (shown by the ESS columns). Several parameters also differ significantly from zero (shown by their 95% credible intervals not overlapping zero). Note that the response variables are not all in the same units, so the magnitudes of the parameter estimates (“Estimate” column) are not directly comparable between the response variables.</p>
<pre class="r"><code>summary(brms_SEM)</code></pre>
<pre style = "max-height:300px; overflow-y: auto;"> Family: MV(gaussian, gaussian, gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: VO2 ~ SELECTION * SEX * CYCLE + BODYMASS + ACTIVITY + SELECTION:BODYMASS + SELECTION:ACTIVITY + SEX:BODYMASS + SEX:ACTIVITY + (1 | LINE) + (1 | SAMPLE) 
         VCO2 ~ VO2 * (0.7 + 0.3 * inv_logit(RQ)) 
         RQ ~ SELECTION * SEX * CYCLE + BODYMASS + ACTIVITY + SELECTION:BODYMASS + SELECTION:ACTIVITY + SEX:BODYMASS + SEX:ACTIVITY + (1 | LINE) + (1 | SAMPLE)
         BODYMASS | subset(body_subset) ~ SELECTION * SEX + (1 | LINE) 
         ACTIVITY ~ SELECTION * SEX * CYCLE + (1 | LINE) + (1 | SAMPLE) 
   Data: scaled_data (Number of observations: 144) 
Samples: 4 chains, each with iter = 10000; warmup = 5000; thin = 1;
         total post-warmup samples = 20000

Group-Level Effects: 
~LINE (Number of levels: 8) 
                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(VO2_Intercept)          0.57      0.38     0.04     1.50 1.00     2996
sd(VCO2_RQ_Intercept)      0.68      0.41     0.08     1.67 1.00     5162
sd(BODYMASS_Intercept)     0.60      0.29     0.20     1.31 1.00     4976
sd(ACTIVITY_Intercept)     0.25      0.20     0.01     0.74 1.00     2952
                       Tail_ESS
sd(VO2_Intercept)          6093
sd(VCO2_RQ_Intercept)      4724
sd(BODYMASS_Intercept)     5656
sd(ACTIVITY_Intercept)     6416

~SAMPLE (Number of levels: 48) 
                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(VO2_Intercept)          1.00      0.17     0.70     1.36 1.00     6308
sd(VCO2_RQ_Intercept)      0.58      0.24     0.11     1.07 1.00     3809
sd(ACTIVITY_Intercept)     0.62      0.09     0.47     0.81 1.00     6888
                       Tail_ESS
sd(VO2_Intercept)          9778
sd(VCO2_RQ_Intercept)      4141
sd(ACTIVITY_Intercept)    12158

Population-Level Effects: 
                                     Estimate Est.Error l-95% CI u-95% CI Rhat
VO2_Intercept                            7.85      0.50     6.86     8.83 1.00
BODYMASS_Intercept                       0.39      0.35    -0.29     1.11 1.00
ACTIVITY_Intercept                      -0.77      0.26    -1.27    -0.25 1.00
VO2_SELECTIONPoly                        0.11      0.58    -1.04     1.25 1.00
VO2_SEXM                                -0.67      0.54    -1.71     0.39 1.00
VO2_CYCLEII                             -1.06      0.33    -1.71    -0.40 1.00
VO2_CYCLEIII                            -1.66      0.33    -2.30    -1.01 1.00
VO2_BODYMASS                             0.29      0.45    -0.58     1.17 1.00
VO2_ACTIVITY                             0.55      0.29    -0.03     1.12 1.00
VO2_SELECTIONPoly:SEXM                   0.05      0.66    -1.26     1.37 1.00
VO2_SELECTIONPoly:CYCLEII                0.30      0.44    -0.59     1.16 1.00
VO2_SELECTIONPoly:CYCLEIII              -0.16      0.44    -1.03     0.70 1.00
VO2_SEXM:CYCLEII                         0.17      0.44    -0.70     1.02 1.00
VO2_SEXM:CYCLEIII                       -0.50      0.45    -1.37     0.38 1.00
VO2_SELECTIONPoly:BODYMASS              -0.20      0.46    -1.10     0.70 1.00
VO2_SELECTIONPoly:ACTIVITY               0.47      0.33    -0.17     1.12 1.00
VO2_SEXM:BODYMASS                        0.35      0.44    -0.53     1.22 1.00
VO2_SEXM:ACTIVITY                        0.52      0.32    -0.11     1.13 1.00
VO2_SELECTIONPoly:SEXM:CYCLEII          -0.32      0.57    -1.44     0.82 1.00
VO2_SELECTIONPoly:SEXM:CYCLEIII          0.40      0.58    -0.73     1.53 1.00
VCO2_RQ_Intercept                        0.04      0.44    -0.82     0.93 1.00
VCO2_RQ_SELECTIONPoly                    0.20      0.57    -0.93     1.30 1.00
VCO2_RQ_SEXM                             0.37      0.50    -0.62     1.35 1.00
VCO2_RQ_CYCLEII                          0.48      0.39    -0.29     1.24 1.00
VCO2_RQ_CYCLEIII                        -0.09      0.38    -0.84     0.66 1.00
VCO2_RQ_BODYMASS                         0.16      0.42    -0.67     0.98 1.00
VCO2_RQ_ACTIVITY                        -0.09      0.33    -0.74     0.56 1.00
VCO2_RQ_SELECTIONPoly:SEXM               0.00      0.65    -1.28     1.27 1.00
VCO2_RQ_SELECTIONPoly:CYCLEII            0.03      0.47    -0.88     0.95 1.00
VCO2_RQ_SELECTIONPoly:CYCLEIII           0.55      0.49    -0.41     1.50 1.00
VCO2_RQ_SEXM:CYCLEII                    -0.49      0.55    -1.56     0.58 1.00
VCO2_RQ_SEXM:CYCLEIII                    0.13      0.59    -1.02     1.29 1.00
VCO2_RQ_SELECTIONPoly:BODYMASS           0.05      0.43    -0.81     0.89 1.00
VCO2_RQ_SELECTIONPoly:ACTIVITY          -0.31      0.36    -1.02     0.40 1.00
VCO2_RQ_SEXM:BODYMASS                   -0.54      0.39    -1.31     0.22 1.00
VCO2_RQ_SEXM:ACTIVITY                    0.29      0.35    -0.41     0.98 1.00
VCO2_RQ_SELECTIONPoly:SEXM:CYCLEII      -0.57      0.63    -1.81     0.66 1.00
VCO2_RQ_SELECTIONPoly:SEXM:CYCLEIII     -0.93      0.67    -2.24     0.40 1.00
BODYMASS_SELECTIONPoly                   0.47      0.46    -0.48     1.34 1.00
BODYMASS_SEXM                           -1.02      0.25    -1.51    -0.53 1.00
BODYMASS_SELECTIONPoly:SEXM             -0.45      0.34    -1.13     0.23 1.00
ACTIVITY_SELECTIONPoly                   1.03      0.35     0.31     1.70 1.00
ACTIVITY_SEXM                            0.47      0.29    -0.10     1.04 1.00
ACTIVITY_CYCLEII                         0.19      0.18    -0.17     0.55 1.00
ACTIVITY_CYCLEIII                        0.24      0.19    -0.13     0.60 1.00
ACTIVITY_SELECTIONPoly:SEXM             -0.08      0.39    -0.83     0.70 1.00
ACTIVITY_SELECTIONPoly:CYCLEII           0.10      0.25    -0.39     0.61 1.00
ACTIVITY_SELECTIONPoly:CYCLEIII         -0.01      0.26    -0.51     0.50 1.00
ACTIVITY_SEXM:CYCLEII                   -0.48      0.26    -0.98     0.02 1.00
ACTIVITY_SEXM:CYCLEIII                  -0.68      0.26    -1.17    -0.17 1.00
ACTIVITY_SELECTIONPoly:SEXM:CYCLEII      0.33      0.35    -0.37     1.00 1.00
ACTIVITY_SELECTIONPoly:SEXM:CYCLEIII     0.52      0.35    -0.18     1.20 1.00
                                     Bulk_ESS Tail_ESS
VO2_Intercept                           10017    11961
BODYMASS_Intercept                       8668    11025
ACTIVITY_Intercept                       7381    10683
VO2_SELECTIONPoly                       11951    13506
VO2_SEXM                                 9755    13672
VO2_CYCLEII                             13271    14215
VO2_CYCLEIII                            12567    14531
VO2_BODYMASS                             8315    11740
VO2_ACTIVITY                            12461    14075
VO2_SELECTIONPoly:SEXM                  10868    12935
VO2_SELECTIONPoly:CYCLEII               14353    14194
VO2_SELECTIONPoly:CYCLEIII              14080    15221
VO2_SEXM:CYCLEII                        12992    14956
VO2_SEXM:CYCLEIII                       13057    14806
VO2_SELECTIONPoly:BODYMASS               7620    11330
VO2_SELECTIONPoly:ACTIVITY              12841    13599
VO2_SEXM:BODYMASS                       10256    13027
VO2_SEXM:ACTIVITY                       13974    14209
VO2_SELECTIONPoly:SEXM:CYCLEII          14905    15352
VO2_SELECTIONPoly:SEXM:CYCLEIII         15153    15508
VCO2_RQ_Intercept                        9661    11473
VCO2_RQ_SELECTIONPoly                   10802    13396
VCO2_RQ_SEXM                            12761    14250
VCO2_RQ_CYCLEII                         14820    15530
VCO2_RQ_CYCLEIII                        15026    15036
VCO2_RQ_BODYMASS                         9453    11753
VCO2_RQ_ACTIVITY                        10401    12519
VCO2_RQ_SELECTIONPoly:SEXM              13221    14611
VCO2_RQ_SELECTIONPoly:CYCLEII           15028    14487
VCO2_RQ_SELECTIONPoly:CYCLEIII          15753    14396
VCO2_RQ_SEXM:CYCLEII                    13824    15479
VCO2_RQ_SEXM:CYCLEIII                   14868    14176
VCO2_RQ_SELECTIONPoly:BODYMASS          10220    12735
VCO2_RQ_SELECTIONPoly:ACTIVITY          11919    13545
VCO2_RQ_SEXM:BODYMASS                   13513    14513
VCO2_RQ_SEXM:ACTIVITY                   13616    14878
VCO2_RQ_SELECTIONPoly:SEXM:CYCLEII      15304    15955
VCO2_RQ_SELECTIONPoly:SEXM:CYCLEIII     15931    14954
BODYMASS_SELECTIONPoly                  10060    12034
BODYMASS_SEXM                           17175    14837
BODYMASS_SELECTIONPoly:SEXM             16168    13544
ACTIVITY_SELECTIONPoly                   7020     9479
ACTIVITY_SEXM                            6526     9168
ACTIVITY_CYCLEII                        10207    13963
ACTIVITY_CYCLEIII                       10262    13911
ACTIVITY_SELECTIONPoly:SEXM              6485     9983
ACTIVITY_SELECTIONPoly:CYCLEII           9995    13051
ACTIVITY_SELECTIONPoly:CYCLEIII          9699    13209
ACTIVITY_SEXM:CYCLEII                   10368    13619
ACTIVITY_SEXM:CYCLEIII                  10046    13188
ACTIVITY_SELECTIONPoly:SEXM:CYCLEII      9814    12798
ACTIVITY_SELECTIONPoly:SEXM:CYCLEIII     9715    13771

Family Specific Parameters: 
               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_VO2          1.03      0.08     0.89     1.20 1.00    11031    12923
sigma_VCO2         0.53      0.04     0.46     0.62 1.00     9205    12925
sigma_BODYMASS     0.66      0.08     0.53     0.83 1.00    14642    11872
sigma_ACTIVITY     0.50      0.04     0.43     0.58 1.00    12572    14516

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).
</pre>
</div>
<div id="make-a-neat-table-of-the-fixed-effects" class="section level3">
<h3>Make a neat table of the fixed effects</h3>
<pre class="r"><code>pvalues &lt;- as.data.frame(p_direction(brms_SEM)) %&gt;% 
  filter(!grepl(&quot;[.]1&quot;, Parameter)) %&gt;%
  mutate(Parameter = str_remove_all(Parameter, &quot;b_&quot;),
         Parameter = str_replace_all(Parameter, &quot;[.]&quot;, &quot;:&quot;),
         p = 1 - pd) %&gt;%
  select(Parameter, p) %&gt;% distinct()


SEM_fixed_effects &lt;- fixef(brms_SEM) %&gt;% 
  as.data.frame() %&gt;%
  rownames_to_column(&quot;Parameter&quot;) %&gt;%
  left_join(pvalues, by = &quot;Parameter&quot;) %&gt;%
  mutate(` ` = ifelse(p &lt; 0.05, &quot;\\*&quot;, &quot;&quot;),
         ` ` = replace(` `, p &gt; 0.05 &amp; p &lt; 0.1, &quot;~&quot;),
         ` ` = replace(` `, p &lt; 0.01, &quot;**&quot;), 
         ` ` = replace(` `, p &lt; 0.001, &quot;***&quot;)) %&gt;%
  mutate(Response = map_chr(strsplit(Parameter, split = &quot;_&quot;), ~ .x[1]),
         Response = str_replace_all(Response, &quot;BODYMASS&quot;, &quot;Body mass&quot;),
         Response = str_replace_all(Response, &quot;ACTIVITY&quot;, &quot;Activity&quot;),
         Response = str_replace_all(Response, &quot;VCO2&quot;, &quot;RQ&quot;),
         Parameter = str_replace_all(Parameter, &quot;BODYMASS&quot;, &quot;Body mass&quot;),
         Parameter = str_replace_all(Parameter, &quot;ACTIVITY&quot;, &quot;Activity&quot;),
         Parameter = str_remove_all(Parameter, &quot;.+_&quot;),
         Parameter = str_replace_all(Parameter, &quot;SELECTIONPoly&quot;, &quot;Polyandry&quot;),
         Parameter = str_replace_all(Parameter, &quot;CYCLEIII&quot;, &quot;Cycle III&quot;),
         Parameter = str_replace_all(Parameter, &quot;CYCLEII&quot;, &quot;Cycle II&quot;),
         Parameter = str_replace_all(Parameter, &quot;SEXM&quot;, &quot;Male&quot;),
         Parameter = str_replace_all(Parameter, &quot;:&quot;, &quot; x &quot;)) %&gt;%
  select(Response, Parameter, everything()) %&gt;%
  mutate(Response = factor(Response, 
                           c(&quot;Activity&quot;, &quot;Body mass&quot;, &quot;VO2&quot;, &quot;RQ&quot;))) %&gt;%
  arrange(Response) %&gt;% 
  select(-Response) 

saveRDS(SEM_fixed_effects, &quot;online_supp/SEM_fixed_effects.rds&quot;)

SEM_fixed_effects %&gt;%
  kable(digits = 3) %&gt;% 
  kable_styling(full_width = FALSE) %&gt;%
  group_rows(&quot;Activity level&quot;, 1, 12) %&gt;%
  group_rows(&quot;Body mass&quot;, 13, 16) %&gt;%
  group_rows(&quot;VO2&quot;, 17, 34) %&gt;%
  group_rows(&quot;Respiratory quotient (RQ)&quot;, 35, 52)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr grouplength="12">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Activity level</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Intercept
</td>
<td style="text-align:right;">
-0.769
</td>
<td style="text-align:right;">
0.259
</td>
<td style="text-align:right;">
-1.268
</td>
<td style="text-align:right;">
-0.252
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
1.030
</td>
<td style="text-align:right;">
0.352
</td>
<td style="text-align:right;">
0.311
</td>
<td style="text-align:right;">
1.699
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
0.468
</td>
<td style="text-align:right;">
0.288
</td>
<td style="text-align:right;">
-0.098
</td>
<td style="text-align:right;">
1.039
</td>
<td style="text-align:right;">
0.053
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle II
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.185
</td>
<td style="text-align:right;">
-0.167
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle III
</td>
<td style="text-align:right;">
0.241
</td>
<td style="text-align:right;">
0.187
</td>
<td style="text-align:right;">
-0.132
</td>
<td style="text-align:right;">
0.600
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male
</td>
<td style="text-align:right;">
-0.078
</td>
<td style="text-align:right;">
0.389
</td>
<td style="text-align:right;">
-0.832
</td>
<td style="text-align:right;">
0.696
</td>
<td style="text-align:right;">
0.418
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle II
</td>
<td style="text-align:right;">
0.103
</td>
<td style="text-align:right;">
0.254
</td>
<td style="text-align:right;">
-0.389
</td>
<td style="text-align:right;">
0.607
</td>
<td style="text-align:right;">
0.347
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle III
</td>
<td style="text-align:right;">
-0.012
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
-0.508
</td>
<td style="text-align:right;">
0.500
</td>
<td style="text-align:right;">
0.477
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle II
</td>
<td style="text-align:right;">
-0.479
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
-0.975
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle III
</td>
<td style="text-align:right;">
-0.680
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
-1.175
</td>
<td style="text-align:right;">
-0.173
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:left;">
**
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle II
</td>
<td style="text-align:right;">
0.328
</td>
<td style="text-align:right;">
0.349
</td>
<td style="text-align:right;">
-0.374
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
0.172
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle III
</td>
<td style="text-align:right;">
0.521
</td>
<td style="text-align:right;">
0.352
</td>
<td style="text-align:right;">
-0.182
</td>
<td style="text-align:right;">
1.203
</td>
<td style="text-align:right;">
0.070
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Body mass</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Intercept
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.352
</td>
<td style="text-align:right;">
-0.293
</td>
<td style="text-align:right;">
1.113
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.472
</td>
<td style="text-align:right;">
0.456
</td>
<td style="text-align:right;">
-0.478
</td>
<td style="text-align:right;">
1.336
</td>
<td style="text-align:right;">
0.138
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-1.017
</td>
<td style="text-align:right;">
0.251
</td>
<td style="text-align:right;">
-1.509
</td>
<td style="text-align:right;">
-0.526
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male
</td>
<td style="text-align:right;">
-0.449
</td>
<td style="text-align:right;">
0.344
</td>
<td style="text-align:right;">
-1.132
</td>
<td style="text-align:right;">
0.228
</td>
<td style="text-align:right;">
0.095
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr grouplength="18">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>VO2</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Intercept
</td>
<td style="text-align:right;">
7.849
</td>
<td style="text-align:right;">
0.502
</td>
<td style="text-align:right;">
6.858
</td>
<td style="text-align:right;">
8.831
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.111
</td>
<td style="text-align:right;">
0.583
</td>
<td style="text-align:right;">
-1.036
</td>
<td style="text-align:right;">
1.248
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
-0.670
</td>
<td style="text-align:right;">
0.536
</td>
<td style="text-align:right;">
-1.714
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.108
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle II
</td>
<td style="text-align:right;">
-1.060
</td>
<td style="text-align:right;">
0.332
</td>
<td style="text-align:right;">
-1.709
</td>
<td style="text-align:right;">
-0.400
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle III
</td>
<td style="text-align:right;">
-1.663
</td>
<td style="text-align:right;">
0.330
</td>
<td style="text-align:right;">
-2.304
</td>
<td style="text-align:right;">
-1.010
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Body mass
</td>
<td style="text-align:right;">
0.290
</td>
<td style="text-align:right;">
0.446
</td>
<td style="text-align:right;">
-0.582
</td>
<td style="text-align:right;">
1.169
</td>
<td style="text-align:right;">
0.259
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Activity
</td>
<td style="text-align:right;">
0.548
</td>
<td style="text-align:right;">
0.293
</td>
<td style="text-align:right;">
-0.029
</td>
<td style="text-align:right;">
1.122
</td>
<td style="text-align:right;">
0.032
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.664
</td>
<td style="text-align:right;">
-1.256
</td>
<td style="text-align:right;">
1.369
</td>
<td style="text-align:right;">
0.471
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle II
</td>
<td style="text-align:right;">
0.300
</td>
<td style="text-align:right;">
0.444
</td>
<td style="text-align:right;">
-0.591
</td>
<td style="text-align:right;">
1.163
</td>
<td style="text-align:right;">
0.245
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle III
</td>
<td style="text-align:right;">
-0.164
</td>
<td style="text-align:right;">
0.437
</td>
<td style="text-align:right;">
-1.026
</td>
<td style="text-align:right;">
0.696
</td>
<td style="text-align:right;">
0.353
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle II
</td>
<td style="text-align:right;">
0.169
</td>
<td style="text-align:right;">
0.441
</td>
<td style="text-align:right;">
-0.701
</td>
<td style="text-align:right;">
1.023
</td>
<td style="text-align:right;">
0.349
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle III
</td>
<td style="text-align:right;">
-0.500
</td>
<td style="text-align:right;">
0.450
</td>
<td style="text-align:right;">
-1.373
</td>
<td style="text-align:right;">
0.376
</td>
<td style="text-align:right;">
0.132
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Body mass
</td>
<td style="text-align:right;">
-0.201
</td>
<td style="text-align:right;">
0.461
</td>
<td style="text-align:right;">
-1.097
</td>
<td style="text-align:right;">
0.704
</td>
<td style="text-align:right;">
0.333
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Activity
</td>
<td style="text-align:right;">
0.474
</td>
<td style="text-align:right;">
0.326
</td>
<td style="text-align:right;">
-0.168
</td>
<td style="text-align:right;">
1.118
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Body mass
</td>
<td style="text-align:right;">
0.345
</td>
<td style="text-align:right;">
0.445
</td>
<td style="text-align:right;">
-0.528
</td>
<td style="text-align:right;">
1.222
</td>
<td style="text-align:right;">
0.218
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Activity
</td>
<td style="text-align:right;">
0.516
</td>
<td style="text-align:right;">
0.319
</td>
<td style="text-align:right;">
-0.108
</td>
<td style="text-align:right;">
1.133
</td>
<td style="text-align:right;">
0.052
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle II
</td>
<td style="text-align:right;">
-0.321
</td>
<td style="text-align:right;">
0.572
</td>
<td style="text-align:right;">
-1.437
</td>
<td style="text-align:right;">
0.815
</td>
<td style="text-align:right;">
0.285
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle III
</td>
<td style="text-align:right;">
0.397
</td>
<td style="text-align:right;">
0.577
</td>
<td style="text-align:right;">
-0.733
</td>
<td style="text-align:right;">
1.527
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="18">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Respiratory quotient (RQ)</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Intercept
</td>
<td style="text-align:right;">
0.039
</td>
<td style="text-align:right;">
0.444
</td>
<td style="text-align:right;">
-0.825
</td>
<td style="text-align:right;">
0.934
</td>
<td style="text-align:right;">
0.465
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry
</td>
<td style="text-align:right;">
0.198
</td>
<td style="text-align:right;">
0.567
</td>
<td style="text-align:right;">
-0.927
</td>
<td style="text-align:right;">
1.301
</td>
<td style="text-align:right;">
0.358
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male
</td>
<td style="text-align:right;">
0.365
</td>
<td style="text-align:right;">
0.501
</td>
<td style="text-align:right;">
-0.616
</td>
<td style="text-align:right;">
1.353
</td>
<td style="text-align:right;">
0.234
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle II
</td>
<td style="text-align:right;">
0.476
</td>
<td style="text-align:right;">
0.387
</td>
<td style="text-align:right;">
-0.286
</td>
<td style="text-align:right;">
1.237
</td>
<td style="text-align:right;">
0.106
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Cycle III
</td>
<td style="text-align:right;">
-0.093
</td>
<td style="text-align:right;">
0.383
</td>
<td style="text-align:right;">
-0.840
</td>
<td style="text-align:right;">
0.658
</td>
<td style="text-align:right;">
0.405
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Body mass
</td>
<td style="text-align:right;">
0.156
</td>
<td style="text-align:right;">
0.420
</td>
<td style="text-align:right;">
-0.675
</td>
<td style="text-align:right;">
0.981
</td>
<td style="text-align:right;">
0.352
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Activity
</td>
<td style="text-align:right;">
-0.088
</td>
<td style="text-align:right;">
0.328
</td>
<td style="text-align:right;">
-0.737
</td>
<td style="text-align:right;">
0.564
</td>
<td style="text-align:right;">
0.391
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.649
</td>
<td style="text-align:right;">
-1.280
</td>
<td style="text-align:right;">
1.268
</td>
<td style="text-align:right;">
0.499
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle II
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
0.466
</td>
<td style="text-align:right;">
-0.879
</td>
<td style="text-align:right;">
0.947
</td>
<td style="text-align:right;">
0.479
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Cycle III
</td>
<td style="text-align:right;">
0.551
</td>
<td style="text-align:right;">
0.488
</td>
<td style="text-align:right;">
-0.415
</td>
<td style="text-align:right;">
1.497
</td>
<td style="text-align:right;">
0.127
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle II
</td>
<td style="text-align:right;">
-0.490
</td>
<td style="text-align:right;">
0.547
</td>
<td style="text-align:right;">
-1.563
</td>
<td style="text-align:right;">
0.576
</td>
<td style="text-align:right;">
0.184
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Cycle III
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.587
</td>
<td style="text-align:right;">
-1.019
</td>
<td style="text-align:right;">
1.286
</td>
<td style="text-align:right;">
0.407
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Body mass
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.429
</td>
<td style="text-align:right;">
-0.805
</td>
<td style="text-align:right;">
0.887
</td>
<td style="text-align:right;">
0.457
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Activity
</td>
<td style="text-align:right;">
-0.308
</td>
<td style="text-align:right;">
0.360
</td>
<td style="text-align:right;">
-1.018
</td>
<td style="text-align:right;">
0.400
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Body mass
</td>
<td style="text-align:right;">
-0.537
</td>
<td style="text-align:right;">
0.388
</td>
<td style="text-align:right;">
-1.305
</td>
<td style="text-align:right;">
0.223
</td>
<td style="text-align:right;">
0.083
</td>
<td style="text-align:left;">
~
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Male x Activity
</td>
<td style="text-align:right;">
0.293
</td>
<td style="text-align:right;">
0.354
</td>
<td style="text-align:right;">
-0.409
</td>
<td style="text-align:right;">
0.979
</td>
<td style="text-align:right;">
0.204
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle II
</td>
<td style="text-align:right;">
-0.569
</td>
<td style="text-align:right;">
0.630
</td>
<td style="text-align:right;">
-1.806
</td>
<td style="text-align:right;">
0.662
</td>
<td style="text-align:right;">
0.186
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
Polyandry x Male x Cycle III
</td>
<td style="text-align:right;">
-0.926
</td>
<td style="text-align:right;">
0.670
</td>
<td style="text-align:right;">
-2.245
</td>
<td style="text-align:right;">
0.396
</td>
<td style="text-align:right;">
0.085
</td>
<td style="text-align:left;">
~
</td>
</tr>
</tbody>
</table>
</div>
<div id="plot-posterior-predictive-checks-1" class="section level3">
<h3>Plot posterior predictive checks</h3>
<p>Again, the fit looks ok.</p>
<pre class="r"><code>pp_check(brms_SEM, resp = &quot;VO2&quot;)</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-19-1">
Past versions of unnamed-chunk-19-1.png
</button>
</p>
<div id="fig-unnamed-chunk-19-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/lukeholman/exp_evol_respiration/blob/0a357584eafe405ea523f32206de82e5ce5ad461/docs/figure/statistics.Rmd/unnamed-chunk-19-1.png" target="_blank">0a35758</a>
</td>
<td>
lukeholman
</td>
<td>
2020-03-03
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="extract-the-posterior-estimates-of-the-means" class="section level3">
<h3>Extract the posterior estimates of the means</h3>
<p>These are used for plotting the range of means that is supported by the data, given our priors. The posterior estimates show the mean of each group, accounting for all the random effects (i.e. the design of the experiment), the covariance structure of the response variables, etc.</p>
<p>We will also use these posteriors for hypothesis testing, e.g. to see if the mean body size of the polyandry flies differs from that of monogamy flies, by subtracting one posterior from the other to get the posterior estimate of the <em>difference</em> in means. If most (e.g. &gt;95%) of this posterior difference lies on one side of zero, the two means may be considered ‘significantly different’ as conventionally defined. The magnitude of the difference in means is also an intuitive measure of effect size, and the posterior gives a sense of how precisely we have estimated effect size.</p>
<pre class="r"><code>new &lt;- scaled_data %&gt;%
  select(SELECTION, SEX, CYCLE) %&gt;%
  distinct() %&gt;%
  mutate(body_subset = TRUE)

# Get the posterior estimate of body weight and activity,
# for the 4 combinations of sex and monogamy/polandry treatment
bodymass &lt;- brms_SEM %&gt;%
  fitted(newdata = new, re_formula = NA,
         resp = &quot;BODYMASS&quot;, summary = FALSE)
activity &lt;- brms_SEM %&gt;%
  fitted(newdata = new, re_formula = NA,
         resp = &quot;ACTIVITY&quot;, summary = FALSE)

new &lt;- left_join(
  data.frame(new, t(bodymass)) %&gt;%
    gather(draw, BODYMASS, starts_with(&quot;X&quot;)) %&gt;% as_tibble(),
  data.frame(new, t(activity)) %&gt;%
    gather(draw, ACTIVITY, starts_with(&quot;X&quot;)) %&gt;% as_tibble(),
  by = c(&quot;SELECTION&quot;, &quot;SEX&quot;, &quot;CYCLE&quot;, &quot;body_subset&quot;, &quot;draw&quot;)) %&gt;%
  mutate(draw = as.numeric(str_remove_all(draw, &quot;X&quot;)))

new &lt;- bind_rows(
  new %&gt;% mutate(mediators_blocked = &quot;Neither&quot;),
  new %&gt;% mutate(mediators_blocked = &quot;Activity&quot;,
                 ACTIVITY = mean(scaled_data$ACTIVITY)),
  new %&gt;% mutate(mediators_blocked = &quot;Body mass&quot;,
                 BODYMASS = mean(scaled_data$BODYMASS))
  ) %&gt;%
  mutate(VO2 = as.numeric(NA),
         RQ = as.numeric(NA)) %&gt;% arrange(draw)


if(length(list.files(&quot;output/temp_files&quot;, full.names = TRUE)) &lt; 20000){
  lapply(1:max(new$draw), function(i){
    print(i)
    focal &lt;- new[new$draw == i, ]
    focal_draw &lt;- focal$draw[1]
    focal$VO2 &lt;- fitted(brms_SEM, re_formula = NA, resp = &quot;VO2&quot;,
                        newdata = focal, subset = focal_draw)[,1]
    focal$RQ &lt;- fitted(brms_SEM, re_formula = NA, resp = &quot;VCO2&quot;, nlpar = &quot;RQ&quot;,
                       newdata = focal, subset = focal_draw)[,1]
    focal %&gt;% saveRDS(glue(&quot;output/temp_files/preds_{i}.rds&quot;))
    rm(focal)
  })
}

posterior_predictions &lt;- list.files(&quot;output/temp_files&quot;, full.names = TRUE) %&gt;% map_df(readRDS)
new_both_blocked &lt;-  (new[1:12, ]) %&gt;% mutate(mediators_blocked = &quot;Both&quot;,
                           BODYMASS = 0,
                           ACTIVITY = 0) %&gt;%
  mutate(key = paste(&quot;V&quot;, 1:n(), sep = &quot;&quot;)) %&gt;% select(-RQ, -draw)

posterior_predictions &lt;- posterior_predictions %&gt;%
  bind_rows(
    left_join(
      fitted(brms_SEM, re_formula = NA, resp = &quot;VO2&quot;,
             newdata = new_both_blocked, summary = FALSE) %&gt;%
        as.data.frame() %&gt;% mutate(draw = 1:n()) %&gt;% gather(key, VO2_pred, -draw) %&gt;% 
        left_join(new_both_blocked, by = &quot;key&quot;),
      fitted(brms_SEM, re_formula = NA, resp = &quot;VCO2&quot;, nlpar = &quot;RQ&quot;,
             newdata = new_both_blocked, summary = FALSE) %&gt;%
        as.data.frame() %&gt;% mutate(draw = 1:n()) %&gt;% gather(key, RQ, -draw) %&gt;% 
        left_join(new_both_blocked, by = &quot;key&quot;), 
      by = c(&quot;draw&quot;, &quot;key&quot;, &quot;SELECTION&quot;, &quot;SEX&quot;, &quot;CYCLE&quot;, 
             &quot;body_subset&quot;, &quot;BODYMASS&quot;, &quot;ACTIVITY&quot;, &quot;mediators_blocked&quot;, &quot;VO2&quot;)
    ) %&gt;% as_tibble() %&gt;% 
      select(-VO2) %&gt;% rename(VO2 = VO2_pred) %&gt;%
      select(!! names(posterior_predictions))
  ) %&gt;% mutate(RQ = 0.7 + 0.3 * inv_logit(RQ))</code></pre>
</div>
</div>
<div id="effect-of-selection-treatment-on-mediator-variables" class="section level2">
<h2>Effect of selection treatment on mediator variables</h2>
<p>Here, we see that triads of flies from the M and P selection treatments differ strongly in activity levels, and (for females) in body mass. Thus, in subsequent analyses, we attempt to partition out the effect of selection on respiration that is due to the difference in body size, activity, or other unmeasured mediator variables (e.g. physiological differences).</p>
<pre class="r"><code>parse_mediators &lt;- function(x){
  var &lt;- x
  x &lt;- get(x)
  ndraws &lt;- nrow(x)
  colnames(x) &lt;- apply(new[1:12, ], 1, paste0, collapse=&quot;~&quot;)
  gather(as_tibble(x)) %&gt;%
    mutate(draw = rep(1:ndraws, 12),
           split = strsplit(key, split = &quot;~&quot;),
           SELECTION = map_chr(split, ~.x[1]),
           CYCLE = map_chr(split, ~.x[3]),
           SEX = map_chr(split, ~.x[2])) %&gt;%
    select(draw, SEX, SELECTION, CYCLE, value) %&gt;%
    mutate(mediator = var)
}

parsed_bodymass &lt;- parse_mediators(&quot;bodymass&quot;) %&gt;%
  filter(CYCLE == &quot;I&quot;)

parsed_activity &lt;- parse_mediators(&quot;activity&quot;)

pd &lt;- position_dodge(0.4)
overall_SD_VO2 &lt;- scaled_data$VO2 %&gt;% sd()
overall_mean_VO2 &lt;- scaled_data$VO2 %&gt;% mean()
overall_SD_RQ &lt;- scaled_data$RQ %&gt;% sd()
overall_mean_RQ &lt;- scaled_data$RQ %&gt;% mean()



posterior_means_plot &lt;- posterior_predictions %&gt;%
  select(draw, SELECTION, SEX, CYCLE, VO2, RQ) %&gt;%
  mutate(VO2 = (VO2 - overall_mean_VO2) / overall_SD_VO2,
         RQ = (RQ - overall_mean_RQ) / overall_SD_RQ) %&gt;%
  left_join((parsed_activity) %&gt;% select(-mediator) %&gt;% rename(Activity = value), 
            by = c(&quot;draw&quot;, &quot;SELECTION&quot;, &quot;SEX&quot;, &quot;CYCLE&quot;)) %&gt;%
  left_join((parsed_bodymass) %&gt;% select(-mediator, -CYCLE) %&gt;% 
              rename(`Body mass` = value), 
            by = c(&quot;draw&quot;, &quot;SELECTION&quot;, &quot;SEX&quot;)) %&gt;%
  filter(!is.na(Activity)) %&gt;%
  gather(resp, value, VO2, RQ, Activity, `Body mass`) %&gt;%
  filter(!(resp == &quot;Body mass&quot; &amp; CYCLE %in% c(&quot;II&quot;, &quot;III&quot;))) %&gt;%
  mutate(CYCLE = replace(CYCLE, resp == &quot;Body mass&quot;, &quot;All&quot;)) %&gt;%
  mutate(SEX = factor(ifelse(SEX == &quot;M&quot;, &quot;Males&quot;, &quot;Females&quot;), c(&quot;Males&quot;, &quot;Females&quot;))) %&gt;%
  mutate(resp = replace(resp, resp == &quot;VO2&quot;, &quot;O2&quot;)) %&gt;%
  mutate(resp = factor(resp, c(&quot;O2&quot;, &quot;RQ&quot;, &quot;Activity&quot;, &quot;Body mass&quot;))) %&gt;%
  mutate(SELECTION = ifelse(SELECTION == &quot;Mono&quot;, &quot;Monogamy&quot;, &quot;Polyandry&quot;)) %&gt;%
  ggplot(aes(CYCLE, value, colour = SELECTION)) + 
  geom_hline(yintercept = 0, linetype = 2) + 
  stat_pointinterval(position = pd, fill = NA, .width = c(0.5, 0.95), alpha = 0.7) + 
  scale_colour_brewer(palette = &quot;Set1&quot;, direction = -1, name = &quot;&quot;) +
  theme_bw() + 
  theme(legend.position = &quot;top&quot;, panel.grid.major.x = element_blank()) + 
  facet_grid(SEX ~ resp, scales = &quot;free&quot;) +
  xlab(&quot;Cycle&quot;) + 
  ylab(&quot;Posterior estimate of the mean&quot;)

posterior_means_plot %&gt;% ggsave(filename = &quot;output/posterior_means_plot.pdf&quot;, width = 6, height = 4.1)
posterior_means_plot</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Figure 3:</strong> LEGEND HERE</p>
</div>
<div id="effect-of-selection-treatment-on-respiration" class="section level2">
<h2>Effect of selection treatment on respiration</h2>
<div id="plot-the-effect-size-for-mp-treatment-on-o2-consumption" class="section level3">
<h3>Plot the effect size for M/P treatment on O2 consumption</h3>
<p>The plot show the model’s best estimates of the effect size of the M/P treatment on VO2, defined as the posterior estimate of difference in mean O2 consumption, divided by the standard deviation in O2 consumption (i.e. Cohen’s <span class="math inline">\(d\)</span>). Positive effect size indicates higher O2 consumption in the polyandry treatment compared to the monogamy treatment.</p>
<p>Effect size was calculated while statistically controlling for one, both, or neither of the two mediator variables (termed “blocking” the mediator variables). Note that the effect size is smaller when activity is controlled for, while controlling for body size had no effect on effect size. Additionally, controlling for activity caused the effect size of the M/P treatment to become statistically indistinguishable from zero. The results therefore indicate that activity mediates most, perhaps all, of the effect of treatment on O2 consumption.</p>
<pre class="r"><code>mediation_figure_VO2 &lt;- posterior_predictions %&gt;%
  mutate(mediators_blocked = replace(mediators_blocked, mediators_blocked == &quot;Body mass&quot;, &quot;Body\nmass&quot;)) %&gt;%
  mutate(mediators_blocked = factor(mediators_blocked, c(&quot;Neither&quot;, &quot;Body\nmass&quot;, &quot;Activity&quot;, &quot;Both&quot;))) %&gt;%
  mutate(SEX = factor(ifelse(SEX==&quot;M&quot;, &quot;Males&quot;, &quot;Females&quot;), c(&quot;Males&quot;, &quot;Females&quot;))) %&gt;%
  mutate(CYCLE = paste(&quot;Cycle&quot;, CYCLE)) %&gt;%
  group_by(draw, SEX, CYCLE, mediators_blocked) %&gt;%
  summarise(VO2_effect = (VO2[SELECTION == &quot;Poly&quot;] - VO2[SELECTION == &quot;Mono&quot;]) / overall_SD_VO2) %&gt;%
  ungroup() %&gt;% 
  ggplot(aes(x = mediators_blocked, 
             y = VO2_effect)) + 
  geom_hline(yintercept = 0, linetype = 2) + 
  stat_pointinterval(point_size = 4) + 
  facet_grid(SEX ~ CYCLE) +
 # coord_cartesian(ylim = c(-1.2, 2.4)) +
  ylab(&quot;Effect size of polyandry treatment\non O2 consumption (Cohen&#39;s d)&quot;) + 
  xlab(&quot;Mediator variables that were controlled for&quot;)  +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)

mediation_figure_VO2 %&gt;% ggsave(filename = &quot;output/mediation_figure_VO2.pdf&quot;, height=4.7, width=8)

mediation_figure_VO2</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;" /></p>
<p><strong>Figure S2</strong>: LEGEND HERE</p>
</div>
<div id="plot-the-effect-size-for-mp-treatment-on-rq" class="section level3">
<h3>Plot the effect size for M/P treatment on RQ</h3>
<p>Equivalent plot, for RQ. Positive effect size indicates higher RQ (i.e. more carbohydrate metabolism and/or less lipid metabolism) in the polyandry treatment compared to the monogamy treatment.</p>
<p>Note that there is little evidence for an effect of treatment on RQ, except perhaps in Cycle III in females. However, we were not able to measure the effect of treatment on RQ with sufficient precision to rule out the existence of a large effect.</p>
<pre class="r"><code>mediation_figure_RQ &lt;- posterior_predictions %&gt;%
  mutate(mediators_blocked = factor(mediators_blocked, c(&quot;Neither&quot;, &quot;Body mass&quot;, &quot;Activity&quot;, &quot;Both&quot;))) %&gt;%
  mutate(SEX = factor(ifelse(SEX==&quot;M&quot;, &quot;Males&quot;, &quot;Females&quot;), c(&quot;Males&quot;, &quot;Females&quot;))) %&gt;%
  mutate(CYCLE = paste(&quot;Cycle&quot;, CYCLE)) %&gt;%
  group_by(draw, SEX, CYCLE, mediators_blocked) %&gt;%
  summarise(RQ_effect = (RQ[SELECTION == &quot;Poly&quot;] - RQ[SELECTION == &quot;Mono&quot;]) / overall_SD_RQ) %&gt;%
  ungroup() %&gt;% 
  ggplot(aes(x = mediators_blocked, 
             y = RQ_effect)) + 
  geom_hline(yintercept = 0, linetype = 2) + 
  stat_pointinterval(point_size = 4) + 
  facet_grid(SEX ~ CYCLE) +
  ylab(&quot;Effect size of polyandry treatment\non RQ (Cohen&#39;s d)&quot;) + 
  xlab(&quot;Mediator variables that were controlled for&quot;)  +
  theme_bw() +
  theme(legend.position = &quot;none&quot;)

mediation_figure_RQ %&gt;% ggsave(filename = &quot;output/mediation_figure_RQ.pdf&quot;, height=4.7, width=8)

mediation_figure_RQ</code></pre>
<p><img src="figure/statistics.Rmd/unnamed-chunk-22-1.png" width="768" style="display: block; margin: auto;" /></p>
<p><strong>Figure S3</strong>: LEGEND HERE</p>
<!-- ## Table of posterior means {.tabset} -->
<!-- These tables show the mean values of VO2 and RQ in each treatment/cycle/sex combination. -->
<!-- ```{r} -->
<!-- tableS1_S2 <- posterior_predictions %>% -->
<!--   gather(resp, value, VO2, RQ) %>% -->
<!--   group_by(resp, mediators_blocked, CYCLE, SEX, SELECTION) %>% -->
<!--   summarise(x = list(posterior_summary(value))) %>% -->
<!--   mutate(Estimate = map_dbl(x, ~ .x[1]), -->
<!--          Error = map_dbl(x, ~ .x[2]), -->
<!--          Lower95CI = map_dbl(x, ~ .x[3]), -->
<!--          Upper95CI = map_dbl(x, ~ .x[4])) %>% -->
<!--   select(-x) %>% ungroup() -->
<!-- tableS1 <- tableS1_S2 %>% -->
<!--   filter(resp == "VO2") %>% -->
<!--   rename(`Mean VO2` = Estimate) %>% -->
<!--   select(-resp) -->
<!-- tableS2 <- tableS1_S2 %>% -->
<!--   filter(resp == "RQ") %>% -->
<!--   rename(`Mean RQ` = Estimate) %>% -->
<!--   select(-resp) -->
<!-- ``` -->
<!-- ### VO2 -->
<!-- ```{r} -->
<!-- tableS1 %>% kable(digits=3) %>% kable_styling() -->
<!-- ``` -->
<!-- ### RQ -->
<!-- ```{r} -->
<!-- tableS2 %>% kable(digits=3) %>% kable_styling() -->
<!-- ``` -->
<!-- ## Tables of posterior differences between selection treatments -->
<!-- The table tests for differences between the M and P treatments in VO2 and RQ. It was calculated as the difference in mean VO2 or RQ between M and P, either alone, or including one or both of the two mediator variables (body size and activity level). The comparison was made separately in each sex/cycle combination. The biggest effect is on males in cycle III: the M males are less active, and therefore they respire less -- there was no evidence for a treatment effect unless the effect of selection on activity level was considered. There were no treatment effects on RQ. -->
<!-- ```{r make_posterior_diff_table} -->
<!-- my_summary <- function(posterior) { -->
<!--   p <- (100 - as.numeric(p_direction(posterior))) / 100 -->
<!--   posterior_summary(posterior) %>% -->
<!--     as.data.frame() %>% -->
<!--     mutate(p = p) %>% -->
<!--     mutate(` ` = ifelse(p < 0.05, "\\*", ""), -->
<!--            ` ` = replace(` `, p > 0.05 & p < 0.1, "~"), -->
<!--            ` ` = replace(` `, p < 0.01, "**"), -->
<!--            ` ` = replace(` `, p < 0.001, "***")) -->
<!-- } -->
<!-- make_posterior_diff_table <- function(posterior_predictions){ -->
<!--   posterior_differences <- posterior_predictions %>% -->
<!--     group_by(resp, path, sex, cycle) %>% -->
<!--     summarise(x = list(my_summary( -->
<!--       value[selection=="Mono"] - -->
<!--         value[selection=="Poly"]))) -->
<!--   bind_cols( -->
<!--     posterior_differences[,-5], -->
<!--     do.call("rbind", posterior_differences %>% pull(5)))  %>% -->
<!--     arrange(desc(resp)) -->
<!-- } -->
<!-- posterior_differences <- posterior_predictions %>% -->
<!--   make_posterior_diff_table() -->
<!-- posterior_differences %>% -->
<!--   kable(digits=3) %>% -->
<!--   kable_styling() -->
<!-- ``` -->
<!-- # FINISH THIS - OLD VERSION BELOW -->
<!-- # posterior_predictions <- new %>% -->
<!-- #   mutate(chunk = rep(1:(nrow(new) / 1000), each = 1000)) %>% # 720 chunks -->
<!-- #   split(.$chunk) %>% -->
<!-- #   map_df(~ { -->
<!-- #     focal_dat <- .x -->
<!-- #     print(focal_dat$chunk[1]) -->
<!-- #     data.frame(.x, fit = fitted(brms_SEM, re_formula = NA, resp = "VO2", newdata = focal_dat)) -->
<!-- #   }) %>% select(-chunk) %>% -->
<!-- #   rename(VO2 = fit.Estimate) %>% -->
<!-- #   select(-starts_with("fit")) %>% -->
<!-- #   as_tibble() -->
<!-- if(!file.exists("data/posterior_predictions.rds")){ -->
<!--   # Calculate the posterior VO2 and RQ for the levels of 'new', either by assuming bodysize and acitivity are at their global means, or by using the means we have estimated for each combination of selection, sex, and cycle -->
<!--   get_post_response <- function(body, act){ -->
<!--     n_combos <- nrow(new) -->
<!--     if(!body) bodyweight <- matrix(0, ncol = n_combos, nrow = 1) -->
<!--     if(!act)  activity <- matrix(0, ncol = n_combos, nrow = 1) -->
<!--     get_diagonal <- function(mat){ -->
<!--       if(ncol(mat) == nrow(mat)) return(diag(mat)) -->
<!--       mat -->
<!--     } -->
<!--     VO2_posterior <- map( -->
<!--       1:n_combos, -->
<!--       ~ brms_SEM %>% -->
<!--         fitted(data.frame( -->
<!--           SELECTION = new$SELECTION[.x], -->
<!--           SEX = new$SEX[.x], -->
<!--           CYCLE = new$CYCLE[.x], -->
<!--           BODYMASS = bodymass[, .x], -->
<!--           ACTIVITY = activity[, .x]), -->
<!--           re_formula = NA, resp = "VO2", -->
<!--           summary = FALSE) %>% -->
<!--         get_diagonal()) %>% -->
<!--       do.call("cbind", .) -->
<!--     RQ_posterior <- map( -->
<!--       1:n_combos, -->
<!--       ~ brms_SEM %>% -->
<!--         fitted(data.frame( -->
<!--           SELECTION = new$SELECTION[.x], -->
<!--           SEX = new$SEX[.x], -->
<!--           BODYMASS = bodymass[, .x], -->
<!--           ACTIVITY = activity[, .x], -->
<!--           CYCLE = new$CYCLE[.x], -->
<!--           VO2 = VO2_posterior[, .x]), -->
<!--           re_formula = NA, resp = "VCO2", -->
<!--           nlpar = "RQ", summary = FALSE) %>% -->
<!--         get_diagonal()) %>% -->
<!--       do.call("cbind", .) -->
<!--     n_draws <- nrow(VO2_posterior) -->
<!--     posterior <- tibble( -->
<!--       value = c(VO2_posterior), -->
<!--       resp = "VO2", -->
<!--       selection = rep(new$SELECTION, each = n_draws), -->
<!--       sex = rep(new$SEX, each = n_draws), -->
<!--       cycle = rep(new$CYCLE, each = n_draws) -->
<!--     ) %>% bind_rows( -->
<!--       tibble( -->
<!--         value = c(RQ_posterior), -->
<!--         resp = "RQ", -->
<!--         selection = rep(new$SELECTION, each = n_draws), -->
<!--         sex = rep(new$SEX, each = n_draws), -->
<!--         cycle = rep(new$CYCLE, each = n_draws) -->
<!--       ) -->
<!--     ) %>% mutate( -->
<!--       value = ifelse(resp == "RQ", -->
<!--                      0.7 + 0.3 * inv_logit(value), -->
<!--                      value)) -->
<!--   } -->
<!--   posterior_predictions <- list( -->
<!--     direct_path = get_post_response(body = F, act = F), -->
<!--     direct_path_plus_bodyweight = get_post_response(body = T, act = F), -->
<!--     direct_path_plus_activity = get_post_response(body = F, act = T), -->
<!--     all_paths = get_post_response(body = T, act = T)) -->
<!--   posterior_predictions <- lapply( -->
<!--     names(posterior_predictions), function(i) { -->
<!--       posterior_predictions[[i]] %>% mutate(path = i) -->
<!--     }) %>% bind_rows() %>% -->
<!--     mutate(path = factor(path, unique(path))) -->
<!--   posterior_predictions <- posterior_predictions %>% -->
<!--     mutate(sex = ifelse(sex == "M", "Male", "Female"), -->
<!--            sex = factor(sex, c("Male", "Female")), -->
<!--            path = replace(as.character(path), -->
<!--                           path == "direct_path", -->
<!--                           "1. Direct effect"), -->
<!--            path = replace(path, -->
<!--                           path == "direct_path_plus_bodyweight", -->
<!--                           "2. Direct + body mass"), -->
<!--            path = replace(path, -->
<!--                           path == "direct_path_plus_activity", -->
<!--                           "3. Direct + activity level"), -->
<!--            path = replace(path, -->
<!--                           path == "all_paths", -->
<!--                           "4. Direct + both mediators")) -->
<!--   posterior_predictions %>% -->
<!--     saveRDS("data/posterior_predictions.rds") -->
<!-- } else { -->
<!--   posterior_predictions <- -->
<!--     readRDS("data/posterior_predictions.rds") -->
<!-- } -->
<!-- ``` -->
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre>R version 3.6.2 (2019-12-12)
Platform: x86_64-apple-darwin15.6.0 (64-bit)
Running under: macOS High Sierra 10.13.6

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] formattable_0.2.0.1 knitrhooks_0.0.4    knitr_1.28         
 [4] GGally_1.4.0        future.apply_1.4.0  future_1.16.0      
 [7] ggridges_0.5.2      MuMIn_1.43.15       bayestestR_0.5.1   
[10] tidybayes_2.0.1     kableExtra_1.1.0    glue_1.3.1         
[13] RColorBrewer_1.1-2  brms_2.12.0         Rcpp_1.0.3         
[16] gridExtra_2.3       forcats_0.4.0       stringr_1.4.0      
[19] dplyr_0.8.4         purrr_0.3.3         readr_1.3.1        
[22] tidyr_1.0.2         tibble_2.1.3        ggplot2_3.3.0      
[25] tidyverse_1.3.0     workflowr_1.6.0    

loaded via a namespace (and not attached):
  [1] readxl_1.3.1         backports_1.1.5      plyr_1.8.5          
  [4] igraph_1.2.4.2       splines_3.6.2        svUnit_0.7-12       
  [7] crosstalk_1.0.0      listenv_0.8.0        rstantools_2.0.0    
 [10] inline_0.3.15        digest_0.6.23        htmltools_0.4.0     
 [13] rsconnect_0.8.16     fansi_0.4.1          magrittr_1.5        
 [16] globals_0.12.5       modelr_0.1.5         matrixStats_0.55.0  
 [19] xts_0.12-0           prettyunits_1.1.1    colorspace_1.4-1    
 [22] rvest_0.3.5          haven_2.2.0          xfun_0.12           
 [25] callr_3.4.1          crayon_1.3.4         jsonlite_1.6.1      
 [28] lme4_1.1-21          zoo_1.8-7            gtable_0.3.0        
 [31] webshot_0.5.2        pkgbuild_1.0.6       rstan_2.19.2        
 [34] abind_1.4-5          scales_1.1.0         mvtnorm_1.0-12      
 [37] DBI_1.1.0            miniUI_0.1.1.1       viridisLite_0.3.0   
 [40] xtable_1.8-4         stats4_3.6.2         StanHeaders_2.21.0-1
 [43] DT_0.12              htmlwidgets_1.5.1    httr_1.4.1          
 [46] threejs_0.3.3        DiagrammeR_1.0.5     arrayhelpers_1.1-0  
 [49] ellipsis_0.3.0       pkgconfig_2.0.3      reshape_0.8.8       
 [52] loo_2.2.0            farver_2.0.3         dbplyr_1.4.2        
 [55] tidyselect_1.0.0     labeling_0.3         rlang_0.4.4         
 [58] reshape2_1.4.3       later_1.0.0          munsell_0.5.0       
 [61] cellranger_1.1.0     tools_3.6.2          visNetwork_2.0.9    
 [64] cli_2.0.1            generics_0.0.2       broom_0.5.4         
 [67] evaluate_0.14        fastmap_1.0.1        yaml_2.2.1          
 [70] processx_3.4.2       fs_1.3.1             nlme_3.1-144        
 [73] whisker_0.4          mime_0.9             xml2_1.2.2          
 [76] compiler_3.6.2       bayesplot_1.7.1      shinythemes_1.1.2   
 [79] rstudioapi_0.11      reprex_0.3.0         stringi_1.4.5       
 [82] highr_0.8            ps_1.3.0             Brobdingnag_1.2-6   
 [85] lattice_0.20-38      Matrix_1.2-18        nloptr_1.2.1        
 [88] markdown_1.1         shinyjs_1.1          vctrs_0.2.2         
 [91] pillar_1.4.3         lifecycle_0.1.0      bridgesampling_0.8-1
 [94] insight_0.8.1        httpuv_1.5.2         R6_2.4.1            
 [97] promises_1.1.0       codetools_0.2-16     boot_1.3-24         
[100] MASS_7.3-51.5        colourpicker_1.0     gtools_3.8.1        
[103] assertthat_0.2.1     rprojroot_1.3-2      withr_2.1.2         
[106] shinystan_2.5.0      parallel_3.6.2       hms_0.5.3           
[109] minqa_1.2.4          coda_0.19-3          rmarkdown_2.1       
[112] git2r_0.26.1         shiny_1.4.0          lubridate_1.7.4     
[115] base64enc_0.1-3      dygraphs_1.1.1.6    
</pre>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
